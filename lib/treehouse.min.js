var F=Object.defineProperty;var K=Object.getOwnPropertyDescriptor;var b=(i,e,o,n)=>{for(var t=n>1?void 0:n?K(e,o):e,r=i.length-1,d;r>=0;r--)(d=i[r])&&(t=(n?d(e,o,t):d(t))||t);return n&&t&&F(e,o,t),t};var B=navigator.userAgent.toLowerCase().indexOf("mac")!==-1;function R(i){if(!i)return[];let e={backspace:"\u232B",shift:"\u21E7",meta:"\u2318",tab:"\u21B9",ctrl:"\u2303",uparrow:"\u2191",downarrow:"\u2193",leftarrow:"\u2190",rightarrow:"\u2192",enter:"\u23CE"};return i.toLowerCase().split("+").map(z).map(n=>Object.keys(e).includes(n)?e[n]:n)}function z(i){return!B&&i==="meta"?"ctrl":i}var N=class{constructor(){this.bindings=[]}registerBinding(e){this.bindings.push(e)}getBinding(e){for(let o of this.bindings)if(o.command===e)return o;return null}evaluateEvent(e){e:for(let o of this.bindings){let n=o.key.toLowerCase().split("+");if(n.pop()===e.key.toLowerCase()){for(let r of["shift","ctrl","alt","meta"]){let d=n.includes(r);if(!B){if(r==="meta")continue;r==="ctrl"&&(d=n.includes("meta")||n.includes("ctrl"))}let s=e[`${z(r)}Key`];if(!s&&d||s&&!d)continue e}return o}}return null}};var P=class{constructor(){this.commands={}}registerCommand(e){this.commands[e.id]=e}executeCommand(e,...o){return this.commands[e].action(...o)}};var Z={};function I(i){let e=new Error().stack;if(e){let n=e.split(`
`)[3].split("/").pop()?.split(".")[0];i.__module=n}Z[w(i)]=i}function w(i){return i.constructor&&i.constructor.__module&&(i=i.constructor),i.__module?`${i.__module}.${i.name}`:i.name}var f=class{constructor(e,o){this.module=e,this.ID=o}changed(){this.module.changed(this)}get isDestroyed(){return!this.module.nodes.hasOwnProperty(this.ID)}get raw(){return this.module.nodes[this.ID]}getName(){return this.raw.Name}setName(e){this.raw.Name=e,this.changed()}getValue(){return this.raw.Value}getParent(){return this.raw.Parent?new f(this.module,this.raw.Parent):null}setParent(e){let o=this.getParent();o!==null&&o.raw.Linked.Children.splice(this.getSiblingIndex(),1),this.raw.Parent=e.ID,e.raw.Linked.Children.push(this.ID),this.changed()}getChildren(){return this.raw.Linked.Children?this.raw.Linked.Children.map(e=>new f(this.module,e)):[]}childCount(){return this.raw.Linked.Children?this.raw.Linked.Children.length:0}getAttr(e){return this.raw.Attrs[e]||""}setAttr(e,o){this.raw.Attrs[e]=o,this.changed()}getSiblingIndex(){let e=this.getParent();return e===null?0:e.raw.Linked.Children.findIndex(o=>o===this.ID)}setSiblingIndex(e){let o=this.getParent();o!==null&&(o.raw.Linked.Children.splice(this.getSiblingIndex(),1),o.raw.Linked.Children.splice(e,0,this.ID),o.changed())}getPrevSibling(){let e=this.getParent();return e===null||this.getSiblingIndex()===0?null:e.getChildren()[this.getSiblingIndex()-1]}getNextSibling(){let e=this.getParent();return e===null||this.getSiblingIndex()===e.getChildren().length-1?null:e.getChildren()[this.getSiblingIndex()+1]}destroy(){this.module.destroy(this)}addComponent(e){let o=this.module.new(w(e),e);o.raw.Parent=this.ID,this.raw.Linked.Components.push(o.ID),this.changed()}removeComponent(e){let o=this.getComponentNodes().filter(n=>n.getName()===w(e));o.length>0&&o[0].destroy(),this.changed()}hasComponent(e){return this.getComponentNodes().filter(n=>n.getName()===w(e)).length>0}getComponent(e){let o=this.getComponentNodes().filter(n=>n.getName()===w(e));return o.length>0?o[0].getValue():null}getComponentNodes(){return this.raw.Linked.Components?this.raw.Linked.Components.map(e=>new f(this.module,e)):[]}getPath(){let e=this,o=[];for(;e;)o.unshift(e.getName()),e=e.getParent();return o.join("/")}find(e){return this.module.find([this.getPath(),e].join("/"))}},S=class{constructor(){this.nodes={"@root":{ID:"@root",Name:"@root",Linked:{Children:[],Components:[]},Attrs:{}}},this.observers=[]}import(e){for(let o of e)this.nodes[o.ID]=o}export(){let e=[];for(let o of Object.values(this.nodes))e.push(o);return e}new(e,o){let n=null;if(e.includes("/")&&!e.startsWith("@")){let d=e.split("/");n=this.getRoot();for(let s=0;s<d.length-1;s++){if(n===null)throw"unable to get root";let l=n.find(d[s]);l||(l=this.new(d.slice(0,s+1).join("/"))),n=l}e=d[d.length-1]}let t=e.startsWith("@")?e:E();this.nodes[t]={ID:t,Name:e,Value:o,Linked:{Children:[],Components:[]},Attrs:{}};let r=new f(this,t);return n&&r.setParent(n),r}destroy(e){let o=e.getParent();o!==null&&(o.raw.Linked.Children.includes(e.ID)&&o.raw.Linked.Children.splice(e.getSiblingIndex(),1),o.raw.Linked.Components.includes(e.ID)&&o.raw.Linked.Components.splice(e.getSiblingIndex(),1)),delete this.nodes[e.ID],o&&this.changed(o)}roots(){return Object.values(this.nodes).filter(e=>e.Parent===void 0).map(e=>new f(this,e.ID))}changed(e){this.observers.forEach(o=>o(e))}getRoot(e){e=e||"@root";let o=this.roots().find(n=>n.getName()===e);return o===void 0?null:o}find(e){let o=this.nodes[e];if(o)return new f(this,o.ID);let n=e.split("/"),t="@root";if(n[0].startsWith("@")&&(t=n.shift()||"",n.length===0))return this.getRoot(t);let r=(s,l)=>s.getChildren().find(c=>c.getName()===l),d=this.getRoot(t);if(!d)return null;for(let s of n){let l=r(d,s);if(!l)return null;d=l}return d}walk(e){let o=(n,t)=>{if(t(n))return!0;for(let r of n.getChildren())if(o(r,t))return!0;return!1};for(let n of this.roots())if(o(n,e))return}},E=()=>{let i=Date.now().toString(36),e=Math.random().toString(36).substring(2);return i+e};function _(i){return{ID:E(),Name:i,Linked:{Children:[],Components:[]},Attrs:{}}}function J(i){let e=[];for(let o=0;o<i;o++)e.push(_(ee(y(2,6))));return e}function H(i){let e={},o=J(i);o.forEach(n=>{e[n.ID]=n,y(0,4)>0&&(n.Parent=o[y(0,i-1)].ID)});for(let[n,t]of Object.entries(e))t.Parent===t.ID&&(t.Parent=void 0),t.Parent&&e[t.Parent].Linked.Children.push(t.ID);return e}var T=["Got","ability","shop","recall","fruit","easy","dirty","giant","shaking","ground","weather","lesson","almost","square","forward","bend","cold","broken","distant","adjective"];function X(i=!1){let e=T[y(0,T.length-1)];return i?e.charAt(0).toUpperCase()+e.slice(1):e}function ee(i=10){return[...Array(i)].map((e,o)=>X(o===0)).join(" ").trim()}function y(i,e){return Math.round(Math.random()*(e-i)+i)}var D=class{constructor(){this.menus={}}registerMenu(e,o){this.menus[e]=o}};var M=class{constructor(e){e.panel=this,this.id=Math.random().toString(36).substring(2),this.history=[e]}};function u(i,e){return i.panel=e,i}var x=class{constructor(e){this.commands=new P,this.keybindings=new N,this.menus=new D,this.search=new MiniSearch({idField:"ID",fields:["ID","Name","Value.markdown"],storeFields:["ID"],extractField:(r,d)=>d.split(".").reduce((s,l)=>s&&s[l],r)}),this.backend=e,this.nodes=new S;let o=this.backend.loadAll(),n=this.nodes.find("@root");if(o.length===0){let r=this.nodes.new("Workspace");r.setParent(n),this.nodes.new("Calendar").setParent(r),this.nodes.new("Home").setParent(r);let l=this.nodes.new("Random");l.setParent(r);for(let c of Object.values(H(1e3)))c.Parent===void 0&&(c.Parent=l.ID,l.raw.Linked.Children.push(c.ID)),o.push(c)}this.nodes.import(o),this.nodes.observers.push(r=>{this.backend.saveAll(Object.values(this.nodes.nodes));let d=s=>{this.search.has(s.ID)?this.search.replace(s.raw):this.search.add(s.raw)};d(r),r.getComponentNodes().forEach(s=>d(s))}),this.search.addAll(Object.values(this.nodes.nodes)),this.context={node:null},this.panels=[[]],this.expanded={};let t=localStorage.getItem("lastopen")||"@root";this.openNewPanel(this.nodes.find(t))}closeQuickAdd(){this.quickadd=null,m.redraw()}openQuickAdd(){let e=this.nodes.find("@quickadd");e||(e=this.nodes.new("@quickadd")),this.quickadd=e}commitQuickAdd(){let e=this.nodes.find("@quickadd");if(!e)return;let o=this.todayNode();e.getChildren().forEach(n=>n.setParent(o))}clearQuickAdd(){let e=this.nodes.find("@quickadd");!e||e.getChildren().forEach(o=>o.destroy())}todayNode(){let e=new Date,o=e.toUTCString().split(e.getFullYear())[0],n=`Week ${String(ne(e)).padStart(2,"0")}`,t=`${e.getFullYear()}`,r=["Workspace","Calendar",t,n,o].join("/"),d=this.nodes.find(r);return d||(d=this.nodes.new(r)),d}openToday(){this.open(this.todayNode())}open(e){this.expanded[e.ID]||(this.expanded[e.ID]={}),localStorage.setItem("lastopen",e.ID),this.panels[0][0]=new M(e)}openNewPanel(e){this.expanded[e.ID]={},localStorage.setItem("lastopen",e.ID);let o=new M(e);this.panels[0].push(o)}closePanel(e){this.panels.forEach((o,n)=>{this.panels[n]=o.filter(t=>t!==e)})}focus(e,o=0){this.context.node=e}getInput(e){return document.getElementById(`input-${e.panel.id}-${e.ID}`)}executeCommand(e,o,...n){return this.commands.executeCommand(e,this.newContext(o),...n)}newContext(e){return Object.assign({},this.context,e)}showMenu(e,o){e.stopPropagation(),e.preventDefault();let n=e.target.closest("*[data-menu]"),t=n.getBoundingClientRect(),r=document.body.scrollLeft+t.x,d=document.body.scrollTop+t.y+t.height,s=this.menus.menus[n.dataset.menu];!s||(this.menu={x:r,y:d,ctx:this.newContext(o),items:s.map(l=>Object.assign(this.commands.commands[l.command],this.keybindings.getBinding(l.command)))},m.redraw())}hideMenu(){this.menu=null,m.redraw()}showPalette(e,o,n){this.palette={x:e,y:o,ctx:n},m.redraw()}hidePalette(){this.palette=null,m.redraw()}getExpanded(e){let o=e.ID;e.panel&&(o=e.panel.history[0].ID),this.expanded[o]||(this.expanded[o]={});let n=this.expanded[o][e.ID];return n===void 0&&(n=!1),n}setExpanded(e,o){this.expanded[e.panel.history[0].ID][e.ID]=o}};function ne(i){var e=new Date(Date.UTC(i.getFullYear(),i.getMonth(),i.getDate())),o=e.getUTCDay()||7;e.setUTCDate(e.getUTCDate()+4-o);var n=new Date(Date.UTC(e.getUTCFullYear(),0,1));return Math.ceil(((e-n)/864e5+1)/7)}var V={view({attrs:i}){let e=i.workspace,o={margin:"0px",listStyleType:"none",padding:"0.25rem 0.5rem 0.25rem 0.5rem",display:"flex"},n={flexGrow:"1",textAlign:"right",color:"#888",marginLeft:"1rem"},t=r=>d=>{e.executeCommand(r.id,i.ctx),e.hideMenu(),d.stopPropagation()};return m("ul",{class:"menu",style:{margin:"0",position:"absolute",left:`${i.x}px`,top:`${i.y}px`,border:"1px solid var(--dark)",borderRadius:"0.25rem",padding:"0.25rem 0 0.25rem 0",display:"inline-block",background:"white",filter:"drop-shadow(2px 2px 4px #5555)",fontSize:"14px",minWidth:"200px"}},i.items.map(r=>m("li",{onclick:t(r),style:o},m("div",null,r.title),m("div",{style:n},R(r.key).join(" ").toUpperCase()))))}};var O={onupdate({state:i,dom:e}){let o=e.querySelector(".commands").children;i.selected!==void 0&&o.length>0&&o[i.selected].scrollIntoView({block:"nearest"})},oncreate({dom:i}){i.querySelector("input").focus()},view({attrs:i,state:e}){let o=i.workspace;e.filter=e.filter===void 0?"":e.filter;let t=Object.values(o.commands.commands).filter(s=>s.id.startsWith(e.filter)),r=s=>{let l=(c,v)=>(c%v+v)%v;if(s.key==="ArrowDown"){if(e.selected===void 0){e.selected=0;return}return e.selected=l(e.selected+1,t.length),!1}if(s.key==="ArrowUp")return e.selected===void 0&&(e.selected=0),e.selected=l(e.selected-1,t.length),!1;if(s.key==="Enter")return e.selected!==void 0&&(o.commands.executeCommand(t[e.selected].id,i.ctx),o.hidePalette()),!1;s.key==="Escape"&&o.hidePalette()},d=s=>{e.filter=s.target.value,e.selected=0};return m("div",{class:"palette",style:{margin:"0",position:"absolute",left:`${i.x}px`,top:`${i.y}px`,border:"1px solid #555",borderRadius:"0.25rem",padding:"0 0 0.25rem 0",background:"white",fontSize:"14px",minWidth:"200px"}},m("div",null,m("input",{style:{width:"100%"},type:"text",onkeydown:r,oninput:d,placeholder:"Enter command..."})),m("div",{class:"commands",style:{overflowY:"scroll",maxHeight:"100px",position:"relative"}},t.map((s,l)=>m("div",{class:e.selected===l?"selected":""},s.id))))}};var q={view({attrs:i,state:e,children:o}){let{node:n,workspace:t}=i,r=t.getExpanded(n),d=a=>{e.hover=!0,a.stopPropagation()},s=a=>{e.hover=!1,a.stopPropagation()},l=a=>{r?t.executeCommand("collapse",{node:n}):t.executeCommand("expand",{node:n}),a.stopPropagation()},c=a=>{t.context.node=n,e.editing=!0,e.buffer=n.getName()},v=a=>{e.editing=!1,n.isDestroyed||n.setName(e.buffer),e.buffer=void 0,t.context.node=null},p=a=>{e.buffer=a.target.value},C=a=>{t.executeCommand("insert-child",{node:n},a.target.value),a.stopPropagation()},L=a=>{switch(a.key){case"Backspace":if(a.target.value===""){t.executeCommand("delete",{node:n}),a.stopPropagation();return}if(a.target.value!==""&&a.target.selectionStart===0){console.log("TODO!"),a.stopPropagation();return}break;case"Enter":if(a.ctrlKey||a.shiftKey||a.metaKey||a.altKey)return;if(a.target.selectionStart===a.target.value.length){t.executeCommand("insert",{node:n}),a.stopPropagation();return}if(a.target.selectionStart===0){t.executeCommand("insert-before",{node:n}),a.stopPropagation();return}if(a.target.selectionStart>0&&a.target.selectionStart<a.target.value.length){e.buffer=a.target.value.slice(0,a.target.selectionStart),t.executeCommand("insert",{node:n},a.target.value.slice(a.target.selectionStart)),a.stopPropagation();return}break}},Y=a=>{let A=n.getComponent(g);A.checked=!A.checked,n.changed()};return m("div",{style:{paddingLeft:"1rem"},onmouseover:d,onmouseout:s},m("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",marginTop:"0.125rem",marginBottom:"0.125rem"}},m("svg",{xmlns:"http://www.w3.org/2000/svg",style:{cursor:"pointer",flexShrink:"0",width:"1rem",height:"1rem",position:"absolute",marginLeft:"-1rem",userSelect:"none",display:e.hover?"block":"none"},onclick:a=>t.showMenu(a,{node:n}),oncontextmenu:a=>t.showMenu(a,{node:n}),"data-menu":"node",fill:"lightgray",viewBox:"0 0 16 16"},m("path",{style:{transform:"translateX(-2px) translateY(-1px)"},d:"M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"}),m("path",{style:{transform:"translateX(2px) translateY(-1px)"},d:"M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"})),m("svg",{onclick:l,oncontextmenu:a=>t.showMenu(a,{node:n}),"data-menu":"node",style:{cursor:"pointer",flexShrink:"0",width:"1rem",height:"1rem",marginRight:"0.5rem",paddingLeft:"1px"},xmlns:"http://www.w3.org/2000/svg",fill:"gray",viewBox:"0 0 16 16"},n.childCount()>0&&!r?m("circle",{cx:"8",cy:"7",r:"7",fill:"lightgray"}):null,m("circle",{cx:"8",cy:"7",r:"3"})),m("div",{style:{flexGrow:"1",display:"flex"}},n.hasComponent(g)?m("input",{type:"checkbox",onclick:Y,checked:n.getComponent(g).checked}):null,m("input",{id:`input-${n.panel?.id}-${n.ID}`,type:"text",value:e.editing?e.buffer:n.getName(),onfocus:c,onblur:v,oninput:p,onkeydown:L,style:{border:"0px",flexGrow:"1",outline:"0px"}}))),m("div",{style:{display:r?"flex":"none",flexDirection:"row",paddingBottom:"0.25rem"}},m("div",{style:{width:"1rem",marginRight:"0.25rem",display:"flex"},onclick:l},m("div",{style:{borderLeft:"1px solid gray",height:"100%",marginLeft:"0.5rem"}})),m("div",{style:{flexGrow:"1"}},n.childCount()>0?n.getChildren().map(a=>m(q,{key:a.ID,workspace:t,node:u(a,n.panel)})):m("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",paddingLeft:"1rem",marginTop:"0.125rem",marginBottom:"0.125rem"}},m("svg",{style:{flexShrink:"0",width:"1rem",height:"1rem",marginRight:"0.5rem",paddingLeft:"1px"},xmlns:"http://www.w3.org/2000/svg",fill:"gray",viewBox:"0 0 16 16"},m("circle",{cx:"8",cy:"7",r:"7",fill:"lightgray"}),m("path",{fill:"#555",style:{transform:"translate(0px, -1px)"},d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"})),m("div",{style:{flexGrow:"1",display:"flex"}},m("input",{type:"text",oninput:C,style:{border:"0px",flexGrow:"1",outline:"0px"}}))))))}},k={view({attrs:i,state:e}){let o=i.node,n=i.workspace,t=r=>{n.executeCommand("insert-child",{node:o},r.target.value),r.stopPropagation()};return m("div",{style:{padding:"var(--padding)"}},o.getChildren().map(r=>m(q,{key:r.ID,workspace:n,node:u(r,o.panel)})),m("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",paddingLeft:"1rem",marginTop:"0.125rem",marginBottom:"0.125rem"}},m("svg",{style:{flexShrink:"0",width:"1rem",height:"1rem",marginRight:"0.5rem",paddingLeft:"1px"},xmlns:"http://www.w3.org/2000/svg",fill:"gray",viewBox:"0 0 16 16"},m("circle",{cx:"8",cy:"7",r:"7",fill:"lightgray"}),m("path",{fill:"#555",style:{transform:"translate(0px, -1px)"},d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"})),m("div",{style:{flexGrow:"1",display:"flex"}},m("input",{type:"text",oninput:t,value:"",style:{border:"0px",flexGrow:"1",outline:"0px"}}))))}};var j={view({attrs:i}){let e=i.panel,o=i.workspace,n=e.history[e.history.length-1],t=p=>{o.executeCommand("close-panel",{},e)},r=p=>{e.history.pop()},d=p=>{o.panels=[[e]]},s=p=>{o.closePanel(e),o.panels.push([e])},l=p=>{o.closePanel(e),o.panels.unshift([e])},c=p=>{n.getComponent(h).markdown=p.target.value,n.changed()};function v(p=""){let C=(p.match(/\n/g)||[]).length;return 20+C*20}return m("div",{style:{display:"flex",flexDirection:"column",flexGrow:"1",margin:"var(--padding)",background:"white",borderRadius:"0.5rem",paddingBottom:"var(--padding)",height:"92vh"}},m("div",{style:{display:"flex",color:"gray",padding:"var(--padding)",paddingTop:"0.5rem",paddingBottom:"0.5rem",gap:"var(--padding)",borderBottom:"4px solid var(--background)"}},e.history.length>1?m("div",{style:{rightPadding:"var(--padding)"}},m("svg",{onclick:r,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},m("path",{"fill-rule":"evenodd",d:"M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"}))):null,m("div",{style:{flexGrow:"1"}},n.getParent()?.getName()),o.panels.flat().length>1?m("div",{style:{display:"flex",gap:"0.5rem"}},m("svg",{onclick:s,style:{transform:"scaleY(-1)"},xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},m("path",{d:"M2.375 1A2.366 2.366 0 0 0 0 3.357v9.286A2.366 2.366 0 0 0 2.375 15h11.25A2.366 2.366 0 0 0 16 12.643V3.357A2.366 2.366 0 0 0 13.625 1H2.375ZM1 3.357C1 2.612 1.611 2 2.375 2h11.25C14.389 2 15 2.612 15 3.357V4H1v-.643ZM1 5h14v7.643c0 .745-.611 1.357-1.375 1.357H2.375A1.366 1.366 0 0 1 1 12.643V5Z"})),m("svg",{onclick:l,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},m("path",{d:"M2.375 1A2.366 2.366 0 0 0 0 3.357v9.286A2.366 2.366 0 0 0 2.375 15h11.25A2.366 2.366 0 0 0 16 12.643V3.357A2.366 2.366 0 0 0 13.625 1H2.375ZM1 3.357C1 2.612 1.611 2 2.375 2h11.25C14.389 2 15 2.612 15 3.357V4H1v-.643ZM1 5h14v7.643c0 .745-.611 1.357-1.375 1.357H2.375A1.366 1.366 0 0 1 1 12.643V5Z"})),m("svg",{onclick:d,style:{transform:"scale(0.9)"},xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},m("path",{d:"M1.5 1a.5.5 0 0 0-.5.5v4a.5.5 0 0 1-1 0v-4A1.5 1.5 0 0 1 1.5 0h4a.5.5 0 0 1 0 1h-4zM10 .5a.5.5 0 0 1 .5-.5h4A1.5 1.5 0 0 1 16 1.5v4a.5.5 0 0 1-1 0v-4a.5.5 0 0 0-.5-.5h-4a.5.5 0 0 1-.5-.5zM.5 10a.5.5 0 0 1 .5.5v4a.5.5 0 0 0 .5.5h4a.5.5 0 0 1 0 1h-4A1.5 1.5 0 0 1 0 14.5v-4a.5.5 0 0 1 .5-.5zm15 0a.5.5 0 0 1 .5.5v4a1.5 1.5 0 0 1-1.5 1.5h-4a.5.5 0 0 1 0-1h4a.5.5 0 0 0 .5-.5v-4a.5.5 0 0 1 .5-.5z"})),m("svg",{onclick:t,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},m("path",{d:"M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"}))):null),m("div",{oncontextmenu:p=>o.showMenu(p,{node:n}),"data-menu":"node",style:{padding:"var(--padding)",fontSize:"2rem"}},n.getName()),n.hasComponent(h)?m("textarea",{oninput:c,value:n.getComponent(h).markdown,placeholder:"Enter Markdown text here",style:{marginLeft:"var(--padding)",padding:"var(--padding)",outline:"0",height:`${v(n.getComponent(h).markdown)}px`,border:"0"}},n.getComponent(h).markdown):null,m(k,{workspace:o,node:n}))}};var G={view({attrs:{workspace:i}}){return m("div",{style:{position:"absolute",left:"0",right:"0",top:"0",bottom:"0"}},m("div",{onclick:()=>i.closeQuickAdd(),style:{position:"absolute",background:"black",opacity:"50%",width:"100%",height:"100%"}}),m("div",{style:{position:"relative",marginLeft:"auto",marginRight:"auto",width:"45vw",borderRadius:"0.5rem",filter:"drop-shadow(2px 2px 4px #5555)",marginTop:"20vh",padding:"2rem",background:"white"}},m("h3",{style:{margin:"0"}},"Quick Add"),m("hr",null),m(k,{workspace:i,node:i.quickadd}),m("hr",null),m("div",null,m("button",{onclick:()=>{i.commitQuickAdd(),i.closeQuickAdd()}},"Add to Today"),m("button",{onclick:()=>{i.clearQuickAdd(),i.closeQuickAdd()}},"Delete"))))}};var W={onupdate({state:i,dom:e}){let o=e.querySelector(".results");o&&i.selected!==void 0&&o.children.length>0&&o.children[i.selected].scrollIntoView({block:"nearest"})},view({attrs:{workspace:i},state:e}){e.query=e.query===void 0?"":e.query;let o=[];e.query&&(e.suggestions=i.search.autoSuggest(e.query),e.suggestions.length>0&&(o=i.search.search(e.suggestions[0].suggestion).map(d=>{let s=i.nodes.find(d.ID);if(!!s&&!(s.getValue()&&(s=s.getParent(),!s.raw)))return s}).filter(d=>d!==void 0)));let n=d=>{i.open(d),e.query=""},t=d=>{let s=(l,c)=>(l%c+c)%c;if(d.key==="ArrowDown"){if(e.selected===void 0){e.selected=0;return}return e.selected=s(e.selected+1,o.length),!1}if(d.key==="ArrowUp")return e.selected===void 0&&(e.selected=0),e.selected=s(e.selected-1,o.length),!1;if(d.key==="Enter")return e.selected!==void 0&&n(o[e.selected]),!1;d.key==="Escape"&&(e.query="")},r=d=>{e.query=d.target.value,e.selected=0};return m("div",{class:"search",style:{position:"relative",flexGrow:"1",padding:"var(--padding)"}},m("input",{type:"text",placeholder:"Search",value:e.query,onkeydown:t,oninput:r,style:{width:"99%",border:"0",outline:"0",background:"transparent",marginRight:"var(--padding)"}}),o.length>0?m("div",{class:"results",style:{overflowY:"scroll",maxHeight:"100px",width:"90%",position:"absolute",background:"white"}},o.map((d,s)=>m("div",{onclick:()=>n(d),class:e.selected===s?"selected":""},d.getName()))):null)}};var Q={view({attrs:{workspace:i},state:e}){e.open=e.open===void 0?!0:e.open;let o=t=>{localStorage.clear(),location.reload()},n=t=>{e.open?e.open=!1:e.open=!0};return m("main",{style:{margin:"0",display:"flex",flexDirection:"column",position:"absolute",top:"0",bottom:"0",left:"0",right:"0"}},m("div",{style:{display:"flex",borderBottom:"1px solid var(--dark)"}},e.open&&m("div",{style:{width:"200px",display:"flex",padding:"var(--padding)"}},m("div",{style:{flexGrow:"1"}},m("img",{src:"/icon_transparent.png",style:{opacity:"70%",width:"16px",height:"16px"}})),m("svg",{onclick:n,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-layout-sidebar",viewBox:"0 0 16 16"},m("path",{d:"M0 3a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3zm5-1v12h9a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1H5zM4 2H2a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h2V2z"}))),m("div",{style:{flexGrow:"1",display:"flex"}},!e.open&&m("svg",{onclick:n,style:{padding:"var(--padding)",borderLeft:"1px solid var(--dark)"},xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-layout-sidebar",viewBox:"0 0 16 16"},m("path",{d:"M0 3a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3zm5-1v12h9a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1H5zM4 2H2a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h2V2z"})),m("div",{style:{borderLeft:"1px solid var(--dark)"}}),m("div",{onclick:()=>i.openToday(),style:{cursor:"pointer",padding:"var(--padding)",display:"flex",alignItems:"center"}},m("svg",{style:{marginRight:"0.25rem",height:"1rem",width:"1rem"},xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 16 16"},m("path",{d:"M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM2 2a1 1 0 0 0-1 1v11a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1H2z"}),m("path",{d:"M2.5 4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5H3a.5.5 0 0 1-.5-.5V4z"}),m("text",{"text-anchor":"middle",x:"8",y:"13",style:{fontSize:"0.55rem"}},new Date().getDate())),m("div",null,"Today")),m("div",{style:{borderLeft:"1px solid var(--dark)"}}),m("div",{onclick:()=>i.openQuickAdd(),style:{cursor:"pointer",padding:"var(--padding)",display:"flex",alignItems:"center"}},m("svg",{style:{marginRight:"0.25rem",height:"1rem",width:"1rem"},xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 16 16"},m("path",{d:"M11.251.068a.5.5 0 0 1 .227.58L9.677 6.5H13a.5.5 0 0 1 .364.843l-8 8.5a.5.5 0 0 1-.842-.49L6.323 9.5H3a.5.5 0 0 1-.364-.843l8-8.5a.5.5 0 0 1 .615-.09zM4.157 8.5H7a.5.5 0 0 1 .478.647L6.11 13.59l5.732-6.09H9a.5.5 0 0 1-.478-.647L9.89 2.41 4.157 8.5z"})),m("div",null,"Quick Add")),m("div",{style:{borderLeft:"1px solid var(--dark)"}}),m(W,{workspace:i}),m("div",{style:{borderLeft:"1px solid var(--dark)"}}),m("div",{style:{padding:"var(--padding)"}},m("button",{onclick:o},"Reset")))),m("div",{style:{display:"flex",flexGrow:"1"}},e.open&&m("div",{style:{width:"200px",padding:"var(--padding)"}},i.nodes.getRoot().getChildren().map(t=>m($,{node:t,expanded:!0,workspace:i}))),m("div",{style:{flexGrow:"1",borderLeft:"1px solid var(--dark)"}},i.panels.map(t=>m("div",{style:{display:"flex"}},t.map(r=>m(j,{workspace:i,panel:r})))))),i.menu&&m(V,{workspace:i,...i.menu}),i.palette&&m(O,{workspace:i,...i.palette}),i.quickadd&&m(G,{workspace:i}))}},$={view({attrs:{node:i,workspace:e,expanded:o},state:n}){n.expanded=n.expanded===void 0?o:n.expanded;let t=d=>{n.expanded?n.expanded=!1:n.expanded=!0,d.stopPropagation()},r=d=>{e.open(i)};return m("div",null,m("div",{style:{display:"flex"}},m("svg",{onclick:t,style:{cursor:"pointer",flexShrink:"0",width:"1rem",height:"1rem",marginRight:"0.5rem",paddingLeft:"1px"},xmlns:"http://www.w3.org/2000/svg",fill:"gray",viewBox:"0 0 16 16"},n.expanded&&m("path",{d:"M3.204 5h9.592L8 10.481 3.204 5zm-.753.659 4.796 5.48a1 1 0 0 0 1.506 0l4.796-5.48c.566-.647.106-1.659-.753-1.659H3.204a1 1 0 0 0-.753 1.659z"}),!n.expanded&&m("path",{d:"M6 12.796V3.204L11.481 8 6 12.796zm.659.753 5.48-4.796a1 1 0 0 0 0-1.506L6.66 2.451C6.011 1.885 5 2.345 5 3.204v9.592a1 1 0 0 0 1.659.753z"})),m("div",{onclick:r,style:{cursor:"pointer",flexGrow:"1",display:"flex"}},i.getName())),n.expanded&&m("div",{style:{paddingBottom:"0.25rem",marginLeft:"0.5rem"}},i.getChildren().map(d=>m($,{workspace:e,node:d}))))}};var U=class{loadAll(){let e=localStorage.getItem("treehouse-nodes");return e==="undefined"&&(e=void 0),JSON.parse(e||"[]")}saveAll(e){localStorage.setItem("treehouse-nodes",JSON.stringify(e))}save(e){}};var g=class{constructor(){this.checked=!1}};g=b([I],g);var h=class{constructor(){this.markdown=""}};h=b([I],h);function We(i,e,o){let n=new x(o);window.workspace=n,n.commands.registerCommand({id:"add-page",title:"Add page",action:t=>{if(!t.node)return;let r=new h;t.node.addComponent(r)}}),n.commands.registerCommand({id:"remove-page",title:"Remove page",action:t=>{!t.node||t.node.removeComponent(h)}}),n.commands.registerCommand({id:"add-checkbox",title:"Add checkbox",action:t=>{if(!t.node)return;let r=new g;t.node.addComponent(r)}}),n.commands.registerCommand({id:"remove-checkbox",title:"Remove checkbox",action:t=>{!t.node||t.node.removeComponent(g)}}),n.commands.registerCommand({id:"mark-done",title:"Mark done",action:t=>{if(!!t.node)if(t.node.hasComponent(g)){let r=t.node.getComponent(g);r.checked?t.node.removeComponent(g):(r.checked=!0,t.node.changed())}else{let r=new g;t.node.addComponent(r)}}}),n.keybindings.registerBinding({command:"mark-done",key:"meta+enter"}),n.commands.registerCommand({id:"expand",title:"Expand",action:t=>{!t.node||(n.setExpanded(t.node,!0),m.redraw())}}),n.keybindings.registerBinding({command:"expand",key:"meta+arrowdown"}),n.commands.registerCommand({id:"collapse",title:"Collapse",action:t=>{!t.node||(n.setExpanded(t.node,!1),m.redraw())}}),n.keybindings.registerBinding({command:"collapse",key:"meta+arrowup"}),n.commands.registerCommand({id:"indent",title:"Indent",action:t=>{if(!t.node)return;let r=t.node.getPrevSibling();r!==null&&(t.node.setParent(r),r.setAttr("expanded",JSON.stringify(!0)),m.redraw.sync(),n.focus(t.node))}}),n.keybindings.registerBinding({command:"indent",key:"tab"}),n.commands.registerCommand({id:"outdent",title:"Outdent",action:t=>{if(!t.node)return;let r=t.node.getParent();r!==null&&r.ID!=="@root"&&(t.node.setParent(r.getParent()),t.node.setSiblingIndex(r.getSiblingIndex()+1),m.redraw.sync(),n.focus(t.node))}}),n.keybindings.registerBinding({command:"outdent",key:"shift+tab"}),n.commands.registerCommand({id:"insert-child",title:"Insert Child",action:(t,r="")=>{if(!t.node)return;let d=n.nodes.new(r);d.setParent(t.node),m.redraw.sync(),n.focus(u(d,t.node.panel),r.length)}}),n.commands.registerCommand({id:"insert-before",title:"Insert Before",action:t=>{if(!t.node)return;let r=n.nodes.new("");r.setParent(t.node.getParent()),r.setSiblingIndex(t.node.getSiblingIndex()),m.redraw.sync(),n.focus(u(r,t.node.panel))}}),n.commands.registerCommand({id:"insert",title:"Insert Node",action:(t,r="")=>{if(!t.node)return;let d=n.nodes.new(r);d.setParent(t.node.getParent()),d.setSiblingIndex(t.node.getSiblingIndex()+1),m.redraw.sync(),n.focus(u(d,t.node.panel))}}),n.keybindings.registerBinding({command:"insert",key:"shift+enter"}),n.commands.registerCommand({id:"delete",title:"Delete node",action:t=>{if(!t.node)return;let r=t.node.getPrevSibling();t.node.destroy(),m.redraw.sync(),r&&n.focus(u(r,t.node.panel))}}),n.keybindings.registerBinding({command:"delete",key:"shift+meta+backspace"}),n.commands.registerCommand({id:"prev",action:t=>{if(!t.node)return;let r=t.node.getPrevSibling();r!==null?n.focus(u(r,t.node.panel)):n.focus(u(t.node.getParent(),t.node.panel))}}),n.keybindings.registerBinding({command:"prev",key:"arrowup"}),n.commands.registerCommand({id:"next",action:t=>{if(!t.node)return;let r=t.node.getNextSibling();if(r!==null)n.focus(u(r,t.node.panel));else return}}),n.keybindings.registerBinding({command:"next",key:"arrowdown"}),n.commands.registerCommand({id:"pick-command",action:t=>{if(!t.node)return;let d=n.getInput(t.node).getBoundingClientRect(),s=i.body.scrollLeft+d.x+200,l=i.body.scrollTop+d.y;n.showPalette(s,l,n.newContext({node:t.node}))}}),n.keybindings.registerBinding({command:"pick-command",key:"meta+k"}),n.commands.registerCommand({id:"new-panel",title:"Open in New Panel",action:t=>{!t.node||(n.openNewPanel(t.node),m.redraw())}}),n.commands.registerCommand({id:"close-panel",title:"Close Panel",action:(t,r)=>{n.closePanel(r||t.node.panel),m.redraw()}}),n.commands.registerCommand({id:"zoom",title:"Zoom",action:t=>{t.node.panel.history.push(t.node),m.redraw()}}),n.menus.registerMenu("node",[{command:"zoom"},{command:"new-panel"},{command:"indent"},{command:"outdent"},{command:"delete"},{command:"add-checkbox"},{command:"remove-checkbox"},{command:"mark-done"},{command:"add-page"},{command:"remove-page"}]),i.addEventListener("keydown",t=>{let r=n.keybindings.evaluateEvent(t);r&&n.context.node&&(n.commands.executeCommand(r.command,n.context),t.stopPropagation(),t.preventDefault())}),i.addEventListener("click",t=>{n.hideMenu()}),m.mount(e,{view:()=>m(Q,{workspace:n})})}export{g as Checkbox,U as LocalStorageStore,h as Page,We as setup};
