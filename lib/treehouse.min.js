var Z=Object.defineProperty;var J=Object.getOwnPropertyDescriptor;var M=(o,e,i,t)=>{for(var n=t>1?void 0:t?J(e,i):e,r=o.length-1,s;r>=0;r--)(s=o[r])&&(n=(t?s(e,i,n):s(n))||n);return t&&n&&Z(e,i,n),n};var O=navigator.userAgent.toLowerCase().indexOf("mac")!==-1;function F(o){if(!o)return[];let e={backspace:"\u232B",shift:"\u21E7",meta:"\u2318",tab:"\u21B9",ctrl:"\u2303",uparrow:"\u2191",downarrow:"\u2193",leftarrow:"\u2190",rightarrow:"\u2192",enter:"\u23CE"};return o.toLowerCase().split("+").map(V).map(t=>Object.keys(e).includes(t)?e[t]:t)}function V(o){return!O&&o==="meta"?"ctrl":o}var k=class{constructor(){this.bindings=[]}registerBinding(e){this.bindings.push(e)}getBinding(e){for(let i of this.bindings)if(i.command===e)return i;return null}evaluateEvent(e){e:for(let i of this.bindings){let t=i.key.toLowerCase().split("+");if(t.pop()===e.key.toLowerCase()){for(let r of["shift","ctrl","alt","meta"]){let s=t.includes(r);if(!O){if(r==="meta")continue;r==="ctrl"&&(s=t.includes("meta")||t.includes("ctrl"))}let d=e[`${V(r)}Key`];if(!d&&s||d&&!s)continue e}return i}}return null}};var C=class{constructor(){this.commands={}}registerCommand(e){this.commands[e.id]=e}executeCommand(e,...i){return this.commands[e].action(...i)}};var X={};function L(o){let e=new Error().stack;if(e){let t=e.split(`
`)[3].split("/").pop()?.split(".")[0];o.__module=t}X[y(o)]=o}function y(o){return o.constructor&&o.constructor.__module&&(o=o.constructor),o.__module?`${o.__module}.${o.name}`:o.name}var v=class{constructor(e,i){this.module=e,this.ID=i}changed(){this.module.changed(this)}get isDestroyed(){return!this.module.nodes.hasOwnProperty(this.ID)}get raw(){return this.module.nodes[this.ID]}getName(){return this.raw.Name}setName(e){this.raw.Name=e,this.changed()}getValue(){return this.raw.Value}getParent(){return this.raw.Parent?new v(this.module,this.raw.Parent):null}setParent(e){let i=this.getParent();i!==null&&i.raw.Linked.Children.splice(this.getSiblingIndex(),1),this.raw.Parent=e.ID,e.raw.Linked.Children.push(this.ID),this.changed()}getChildren(){return this.raw.Linked.Children?this.raw.Linked.Children.map(e=>new v(this.module,e)):[]}childCount(){return this.raw.Linked.Children?this.raw.Linked.Children.length:0}getAttr(e){return this.raw.Attrs[e]||""}setAttr(e,i){this.raw.Attrs[e]=i,this.changed()}getSiblingIndex(){let e=this.getParent();return e===null?0:e.raw.Linked.Children.findIndex(i=>i===this.ID)}setSiblingIndex(e){let i=this.getParent();i!==null&&(i.raw.Linked.Children.splice(this.getSiblingIndex(),1),i.raw.Linked.Children.splice(e,0,this.ID),i.changed())}getPrevSibling(){let e=this.getParent();return e===null||this.getSiblingIndex()===0?null:e.getChildren()[this.getSiblingIndex()-1]}getNextSibling(){let e=this.getParent();return e===null||this.getSiblingIndex()===e.getChildren().length-1?null:e.getChildren()[this.getSiblingIndex()+1]}destroy(){this.module.destroy(this)}addComponent(e){let i=this.module.new(y(e),e);i.raw.Parent=this.ID,this.raw.Linked.Components.push(i.ID),this.changed()}removeComponent(e){let i=this.getComponentNodes().filter(t=>t.getName()===y(e));i.length>0&&i[0].destroy(),this.changed()}hasComponent(e){return this.getComponentNodes().filter(t=>t.getName()===y(e)).length>0}getComponent(e){let i=this.getComponentNodes().filter(t=>t.getName()===y(e));return i.length>0?i[0].getValue():null}getComponentNodes(){return this.raw.Linked.Components?this.raw.Linked.Components.map(e=>new v(this.module,e)):[]}getPath(){let e=this,i=[];for(;e;)i.unshift(e.getName()),e=e.getParent();return i.join("/")}find(e){return this.module.find([this.getPath(),e].join("/"))}},N=class{constructor(){this.nodes={"@root":{ID:"@root",Name:"@root",Linked:{Children:[],Components:[]},Attrs:{}}},this.observers=[]}import(e){for(let i of e)this.nodes[i.ID]=i}export(){let e=[];for(let i of Object.values(this.nodes))e.push(i);return e}new(e,i){let t=null;if(e.includes("/")&&!e.startsWith("@")){let s=e.split("/");t=this.getRoot();for(let d=0;d<s.length-1;d++){if(t===null)throw"unable to get root";let l=t.find(s[d]);l||(l=this.new(s.slice(0,d+1).join("/"))),t=l}e=s[s.length-1]}let n=e.startsWith("@")?e:ee();this.nodes[n]={ID:n,Name:e,Value:i,Linked:{Children:[],Components:[]},Attrs:{}};let r=new v(this,n);return t&&r.setParent(t),r}destroy(e){let i=e.getParent();i!==null&&(i.raw.Linked.Children.includes(e.ID)&&i.raw.Linked.Children.splice(e.getSiblingIndex(),1),i.raw.Linked.Components.includes(e.ID)&&i.raw.Linked.Components.splice(e.getSiblingIndex(),1)),delete this.nodes[e.ID],i&&this.changed(i)}roots(){return Object.values(this.nodes).filter(e=>e.Parent===void 0).map(e=>new v(this,e.ID))}changed(e){this.observers.forEach(i=>i(e))}getRoot(e){e=e||"@root";let i=this.roots().find(t=>t.getName()===e);return i===void 0?null:i}find(e){let i=this.nodes[e];if(i)return new v(this,i.ID);let t=e.split("/"),n="@root";if(t[0].startsWith("@")&&(n=t.shift()||"",t.length===0))return this.getRoot(n);let r=(d,l)=>d.getChildren().find(c=>c.getName()===l),s=this.getRoot(n);if(!s)return null;for(let d of t){let l=r(s,d);if(!l)return null;s=l}return s}walk(e){let i=(t,n)=>{if(n(t))return!0;for(let r of t.getChildren())if(i(r,n))return!0;return!1};for(let t of this.roots())if(i(t,e))return}},ee=()=>{let o=Date.now().toString(36),e=Math.random().toString(36).substring(2);return o+e};var S=class{constructor(){this.menus={}}registerMenu(e,i){this.menus[e]=i}};var I=class{constructor(e){e.panel=this,this.id=Math.random().toString(36).substring(2),this.history=[e]}get current(){return this.history[this.history.length-1]}};function g(o,e){return o.panel=e,o}var x=class{constructor(e){this.commands=new C,this.keybindings=new k,this.menus=new S,this.backend=e,this.nodes=new N,this.context={node:null},this.panels=[[]],this.expanded={}}async initialize(){let e=await this.backend.nodes.loadAll(),i=this.nodes.find("@root");if(e.length===0){let t=this.nodes.new("Workspace");t.setParent(i),this.nodes.new("Calendar").setParent(t),this.nodes.new("Home").setParent(t)}this.nodes.import(e),this.nodes.observers.push(t=>{this.backend.nodes.saveAll(Object.values(this.nodes.nodes)),this.backend.index.index(t.raw),t.getComponentNodes().forEach(n=>this.backend.index.index(n.raw))}),Object.values(this.nodes.nodes).forEach(t=>this.backend.index.index(t)),this.openNewPanel(this.nodes.find("@root/Workspace")),m.redraw(),localStorage.getItem("firsttime")||this.showNotice("firsttime")}authenticated(){return this.backend.auth&&this.backend.auth.currentUser()}closeQuickAdd(){this.quickadd=null,m.redraw()}openQuickAdd(){let e=this.nodes.find("@quickadd");e||(e=this.nodes.new("@quickadd")),this.quickadd=e}commitQuickAdd(){let e=this.nodes.find("@quickadd");if(!e)return;let i=this.todayNode();e.getChildren().forEach(t=>t.setParent(i))}clearQuickAdd(){let e=this.nodes.find("@quickadd");e&&e.getChildren().forEach(i=>i.destroy())}todayNode(){let e=new Date,i=e.toUTCString().split(e.getFullYear())[0],t=`Week ${String(te(e)).padStart(2,"0")}`,r=["Workspace","Calendar",`${e.getFullYear()}`,t,i].join("/"),s=this.nodes.find(r);return s||(s=this.nodes.new(r)),s}openToday(){this.open(this.todayNode())}open(e){this.expanded[e.ID]||(this.expanded[e.ID]={}),localStorage.setItem("lastopen",e.ID),this.panels[0][0]=new I(e)}openNewPanel(e){this.expanded[e.ID]={},localStorage.setItem("lastopen",e.ID);let i=new I(e);this.panels[0].push(i)}closePanel(e){this.panels.forEach((i,t)=>{this.panels[t]=i.filter(n=>n!==e)})}focus(e,i=0){this.context.node=e,e&&(document.getElementById(`input-${e.panel?.id}-${e.ID}`)?.focus(),document.getElementById(`input-${e.panel?.id}-${e.ID}`)?.setSelectionRange(i,i))}getInput(e){return document.getElementById(`input-${e.panel?.id}-${e.ID}`)}executeCommand(e,i,...t){return this.commands.executeCommand(e,this.newContext(i),...t)}newContext(e){return Object.assign({},this.context,e)}showMenu(e,i){e.stopPropagation(),e.preventDefault();let t=e.target.closest("*[data-menu]"),n=t.getBoundingClientRect(),r=t.dataset.align||"left",s=document.body.scrollLeft+n.x;r==="right"&&(s=window.innerWidth-n.right-n.width);let d=document.body.scrollTop+n.y+n.height,l=this.menus.menus[t.dataset.menu],c=l.filter(u=>u.command).map(u=>this.commands.commands[u.command]);l&&(this.menu={x:s,y:d,ctx:this.newContext(i),items:l,commands:c,align:r},m.redraw())}hideMenu(){this.menu=null,m.redraw()}showPalette(e,i,t){this.palette={x:e,y:i,ctx:t},m.redraw()}hidePalette(){this.palette=null,m.redraw()}showNotice(e,i){this.notice={message:e,finished:i},m.redraw()}hideNotice(){this.notice=null,m.redraw()}getExpanded(e){let i=e.ID;e.panel&&(i=e.panel.history[0].ID),this.expanded[i]||(this.expanded[i]={});let t=this.expanded[i][e.ID];return t===void 0&&(t=!1),t}setExpanded(e,i){this.expanded[e.panel.history[0].ID][e.ID]=i}findAbove(e){if(e.ID===e.panel.current.ID)return null;let i=e.panel,t=e.getPrevSibling();if(!t)return g(e.getParent(),i);let n=r=>{if(!this.getExpanded(g(r,i))||r.childCount()===0)return r;let d=r.getChildren()[r.childCount()-1];return n(d)};return g(n(t),i)}findBelow(e){let i=e.panel;if(this.getExpanded(e)&&e.childCount()>0)return g(e.getChildren()[0],i);let t=n=>{let r=n.getNextSibling();if(r)return g(r,i);let s=n.getParent();return!s||s.ID===i.current.ID?null:t(s)};return t(e)}};function te(o){var e=new Date(Date.UTC(o.getFullYear(),o.getMonth(),o.getDate())),i=e.getUTCDay()||7;e.setUTCDate(e.getUTCDate()+4-i);var t=new Date(Date.UTC(e.getUTCFullYear(),0,1));return Math.ceil(((e-t)/864e5+1)/7)}var $={view({attrs:{workspace:o,x:e,y:i,items:t,align:n,commands:r,ctx:s}}){let d=(c,u)=>h=>{h.stopPropagation(),!c.disabled&&(c.onclick&&c.onclick(),u&&o.executeCommand(u.id,s),o.hideMenu())},l={left:`${e}px`};return n==="right"&&(l={right:`${e}px`}),m("ul",{class:"menu",style:Object.assign(l,{margin:"0",position:"absolute",top:`${i}px`,border:"1px solid var(--dark)",borderRadius:"0.25rem",padding:"0.25rem 0 0.25rem 0",display:"inline-block",background:"white",filter:"drop-shadow(2px 2px 4px #5555)",fontSize:"14px",minWidth:"200px"})},t.filter(c=>!c.when||c.when()).map(c=>{let u="",h,a;return c.command&&(a=r.find(w=>w.id===c.command),h=o.keybindings.getBinding(a.id),u=a.title),c.title&&(u=c.title()),m("li",{onclick:d(c,a),class:c.disabled?"disabled":"",style:{margin:"0px",listStyleType:"none",padding:"0.25rem 0.5rem 0.25rem 0.5rem",display:"flex"}},m("div",null,u),h&&m("div",{style:{flexGrow:"1",textAlign:"right",color:"#888",marginLeft:"1rem"}},F(h.key).join(" ").toUpperCase()))}))}};var j={onupdate({state:o,dom:e}){let i=e.querySelector(".commands").children;o.selected!==void 0&&i.length>0&&i[o.selected].scrollIntoView({block:"nearest"})},oncreate({dom:o}){o.querySelector("input").focus()},view({attrs:o,state:e}){let i=o.workspace;e.filter=e.filter===void 0?"":e.filter;let n=Object.values(i.commands.commands).filter(d=>d.id.startsWith(e.filter)),r=d=>{let l=(c,u)=>(c%u+u)%u;if(d.key==="ArrowDown"){if(e.selected===void 0){e.selected=0;return}return e.selected=l(e.selected+1,n.length),!1}if(d.key==="ArrowUp")return e.selected===void 0&&(e.selected=0),e.selected=l(e.selected-1,n.length),!1;if(d.key==="Enter")return e.selected!==void 0&&(i.commands.executeCommand(n[e.selected].id,o.ctx),i.hidePalette()),!1;d.key==="Escape"&&i.hidePalette()},s=d=>{e.filter=d.target.value,e.selected=0};return m("div",{class:"palette",style:{margin:"0",position:"absolute",left:`${o.x}px`,top:`${o.y}px`,border:"1px solid var(--dark)",borderRadius:"0.25rem",padding:"0.5rem",background:"white",fontSize:"14px",minWidth:"400px"}},m("div",null,m("input",{style:{width:"98%",outline:"0",border:"0"},type:"text",onkeydown:r,oninput:s,placeholder:"Enter command..."})),m("div",{class:"commands",style:{margin:"0.25rem",overflowY:"scroll",maxHeight:"200px",position:"relative"}},n.map((d,l)=>m("div",{style:{padding:"0.25rem"},class:e.selected===l?"selected":""},d.title||d.id))))}};var q={view({attrs:o,state:e,children:i}){let{node:t,workspace:n}=o,r=n.getExpanded(t),s=a=>{e.hover=!0,a.stopPropagation()},d=a=>{e.hover=!1,a.stopPropagation()},l=a=>{r?n.executeCommand("collapse",{node:t}):n.executeCommand("expand",{node:t}),a.stopPropagation()},c=a=>{switch(a.key){case"ArrowUp":a.target.selectionStart!==0&&a.stopPropagation();break;case"ArrowDown":a.target.selectionStart!==a.target.value.length&&a.target.selectionStart!==0&&a.stopPropagation();break;case"Backspace":if(a.target.value===""){a.preventDefault(),a.stopPropagation(),n.executeCommand("delete",{node:t,event:a});return}if(a.target.value!==""&&a.target.selectionStart===0&&a.target.selectionEnd===0){a.preventDefault(),a.stopPropagation();let w=n.findAbove(t);if(!w)return;let T=w.getName();w.setName(T+a.target.value),t.destroy(),m.redraw.sync(),n.focus(g(w,t.panel),T.length);return}break;case"Enter":if(a.preventDefault(),a.ctrlKey||a.shiftKey||a.metaKey||a.altKey)return;if(a.target.selectionStart===a.target.value.length){n.executeCommand("insert",{node:t}),a.stopPropagation();return}if(a.target.selectionStart===0){n.executeCommand("insert-before",{node:t}),a.stopPropagation();return}if(a.target.selectionStart>0&&a.target.selectionStart<a.target.value.length){e.buffer=a.target.value.slice(0,a.target.selectionStart),n.executeCommand("insert",{node:t},a.target.value.slice(a.target.selectionStart)),a.stopPropagation();return}break}},u=a=>{let w=t.getComponent(p);w.checked=!w.checked,t.changed()},h=a=>{a.preventDefault(),a.stopPropagation(),n.executeCommand("zoom",{node:t}),document.selection&&document.selection.empty?document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges()};return m("div",{style:{paddingLeft:"1rem"},onmouseover:s,onmouseout:d},m("div",{style:{display:"flex",flexDirection:"row",alignItems:"start",marginTop:"0.125rem",marginBottom:"0.125rem"}},m("svg",{xmlns:"http://www.w3.org/2000/svg",style:{cursor:"pointer",flexShrink:"0",width:"1rem",height:"1rem",position:"absolute",marginLeft:"-1rem",userSelect:"none",marginTop:"0.25rem",display:e.hover?"block":"none"},onclick:a=>n.showMenu(a,{node:t}),oncontextmenu:a=>n.showMenu(a,{node:t}),"data-menu":"node",fill:"lightgray",viewBox:"0 0 16 16"},m("path",{style:{transform:"translateY(-1px)"},"fill-rule":"evenodd",d:"M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z"})),m("svg",{onclick:l,ondblclick:h,oncontextmenu:a=>n.showMenu(a,{node:t}),"data-menu":"node",style:{cursor:"pointer",flexShrink:"0",width:"1rem",height:"1rem",marginRight:"0.5rem",paddingLeft:"1px",marginTop:"0.25rem"},xmlns:"http://www.w3.org/2000/svg",fill:"gray",viewBox:"0 0 16 16"},t.childCount()>0&&!r?m("circle",{cx:"8",cy:"7",r:"7",fill:"lightgray"}):null,m("circle",{cx:"8",cy:"7",r:"3"})),m("div",{style:{flexGrow:"1",display:"flex",alignItems:"start"}},t.hasComponent(p)?m("input",{type:"checkbox",style:{marginTop:"0.3rem",marginRight:"0.5rem"},onclick:u,checked:t.getComponent(p).checked}):null,m(A,{workspace:n,node:t,onkeydown:c}))),r===!0&&m("div",{style:{display:"flex",flexDirection:"row",paddingBottom:"0.25rem"}},m("div",{style:{width:"1rem",marginRight:"0.25rem",display:"flex"},onclick:l},m("div",{style:{borderLeft:"1px solid gray",height:"100%",marginLeft:"0.5rem"}})),m("div",{style:{flexGrow:"1"}},t.childCount()>0?t.getChildren().map(a=>m(q,{key:a.ID,workspace:n,node:g(a,t.panel)})):m(U,{workspace:n,node:t}))))}},U={view({attrs:{workspace:o,node:e}}){return m("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",paddingLeft:"1rem",marginTop:"0.125rem",marginBottom:"0.125rem"}},m("svg",{style:{flexShrink:"0",width:"1rem",height:"1rem",marginRight:"0.5rem",paddingLeft:"1px"},xmlns:"http://www.w3.org/2000/svg",fill:"gray",viewBox:"0 0 16 16"},m("circle",{cx:"8",cy:"7",r:"7",fill:"lightgray"}),m("path",{fill:"#555",style:{transform:"translate(0px, -1px)"},d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"})),m("div",{style:{flexGrow:"1",display:"flex"}},m("input",{type:"text",oninput:n=>{o.executeCommand("insert-child",{node:e},n.target.value)},onkeydown:n=>{if(n.key==="Tab"&&(n.stopPropagation(),n.preventDefault(),e.childCount()>0)){let r=e.getChildren()[e.childCount()-1];o.executeCommand("insert-child",{node:g(r,e.panel)})}},value:"",style:{border:"0px",flexGrow:"1",outline:"0px"}})))}},D={view({attrs:{workspace:o,node:e},state:i}){return m("div",{style:{padding:"var(--padding)"}},e.getChildren().map(t=>m(q,{key:t.ID,workspace:o,node:g(t,e.panel)})),m(U,{workspace:o,node:e}))}},A={oncreate({dom:o}){let e=o.querySelector("textarea"),i=e.offsetHeight,t=o.querySelector("span"),n=()=>{t.style.width=`${Math.max(e.offsetWidth,100)}px`,t.innerHTML=e.value.replace(`
`,"<br/>"),e.style.height=t.offsetHeight>0?`${t.offsetHeight}px`:`${i}px`};e.addEventListener("input",()=>n()),e.addEventListener("blur",()=>t.innerHTML=""),setTimeout(()=>n(),50)},view({attrs:{workspace:o,node:e,onkeydown:i,disallowEmpty:t},state:n}){let r=n.editing?n.buffer:e.getName(),s=h=>{h.key==="Enter"&&(h.preventDefault(),h.stopPropagation())},d=h=>{n.initialValue=e.getName(),o.context.node=e,n.editing=!0,n.buffer=e.getName()},l=h=>{n.editing=!1,e.isDestroyed||(t&&n.buffer.length===0?e.setName(n.initialValue):e.setName(n.buffer)),n.buffer=void 0,o.context.node=null},c=h=>{n.buffer=h.target.value,t&&n.buffer.length===0?e.setName(n.initialValue):e.setName(n.buffer)},u={outline:"none",fontSize:"inherit",fontFamily:"inherit",padding:"0",width:"100%",boxSizing:"border-box",resize:"none",overflow:"hidden",display:"block",lineHeight:"1.45",border:"none"};return m("div",{style:{width:"100%",marginBottom:"0.5rem"}},m("textarea",{style:u,id:`input-${e.panel?.id}-${e.ID}`,rows:"1",onfocus:d,onblur:l,oninput:c,onkeydown:i||s,value:r},r),m("span",{style:Object.assign({visibility:"hidden",position:"fixed"},u)}))}};var G={view({attrs:o}){let e=o.panel,i=o.workspace,t=e.history[e.history.length-1],n=h=>{i.executeCommand("close-panel",{},e)},r=h=>{e.history.pop()},s=h=>{i.panels=[[e]]},d=h=>{i.closePanel(e),i.panels.push([e])},l=h=>{i.closePanel(e),i.panels.unshift([e])},c=h=>{t.getComponent(f).markdown=h.target.value,t.changed()};function u(h=""){return 20+(h.match(/\n/g)||[]).length*20}return m("div",{style:{display:"flex",flexDirection:"column",flexGrow:"1",margin:"var(--padding)",paddingBottom:"var(--padding)",height:"92vh"}},m("div",{style:{display:"flex",background:"white",borderRadius:"0.5rem",color:"gray",padding:"var(--padding)",paddingTop:"0.5rem",paddingBottom:"0.5rem",gap:"var(--padding)",marginBottom:"0.5rem"}},e.history.length>1?m("div",{style:{rightPadding:"var(--padding)"}},m("svg",{onclick:r,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},m("path",{"fill-rule":"evenodd",d:"M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"}))):null,m("div",{style:{flexGrow:"1"}},t.getParent()&&t.getParent().ID!=="@root"?m("span",{style:{cursor:"pointer"},onclick:()=>i.open(t.getParent())},t.getParent().getName()):null),i.panels.flat().length>1?m("div",{style:{display:"flex",gap:"0.5rem"}},m("svg",{onclick:d,style:{cursor:"pointer",transform:"scaleY(-1)"},xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},m("path",{d:"M2.375 1A2.366 2.366 0 0 0 0 3.357v9.286A2.366 2.366 0 0 0 2.375 15h11.25A2.366 2.366 0 0 0 16 12.643V3.357A2.366 2.366 0 0 0 13.625 1H2.375ZM1 3.357C1 2.612 1.611 2 2.375 2h11.25C14.389 2 15 2.612 15 3.357V4H1v-.643ZM1 5h14v7.643c0 .745-.611 1.357-1.375 1.357H2.375A1.366 1.366 0 0 1 1 12.643V5Z"})),m("svg",{onclick:l,style:{cursor:"pointer"},xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},m("path",{d:"M2.375 1A2.366 2.366 0 0 0 0 3.357v9.286A2.366 2.366 0 0 0 2.375 15h11.25A2.366 2.366 0 0 0 16 12.643V3.357A2.366 2.366 0 0 0 13.625 1H2.375ZM1 3.357C1 2.612 1.611 2 2.375 2h11.25C14.389 2 15 2.612 15 3.357V4H1v-.643ZM1 5h14v7.643c0 .745-.611 1.357-1.375 1.357H2.375A1.366 1.366 0 0 1 1 12.643V5Z"})),m("svg",{onclick:s,style:{cursor:"pointer",transform:"scale(0.9)"},xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},m("path",{d:"M1.5 1a.5.5 0 0 0-.5.5v4a.5.5 0 0 1-1 0v-4A1.5 1.5 0 0 1 1.5 0h4a.5.5 0 0 1 0 1h-4zM10 .5a.5.5 0 0 1 .5-.5h4A1.5 1.5 0 0 1 16 1.5v4a.5.5 0 0 1-1 0v-4a.5.5 0 0 0-.5-.5h-4a.5.5 0 0 1-.5-.5zM.5 10a.5.5 0 0 1 .5.5v4a.5.5 0 0 0 .5.5h4a.5.5 0 0 1 0 1h-4A1.5 1.5 0 0 1 0 14.5v-4a.5.5 0 0 1 .5-.5zm15 0a.5.5 0 0 1 .5.5v4a1.5 1.5 0 0 1-1.5 1.5h-4a.5.5 0 0 1 0-1h4a.5.5 0 0 0 .5-.5v-4a.5.5 0 0 1 .5-.5z"})),m("svg",{onclick:n,style:{cursor:"pointer"},xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},m("path",{d:"M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"}))):null),m("div",{style:{background:"white",borderRadius:"0.5rem",display:"flex",flexDirection:"column"}},m("div",{oncontextmenu:h=>i.showMenu(h,{node:t}),"data-menu":"node",style:{padding:"var(--padding)",fontSize:"2rem"}},m(A,{workspace:i,node:t,disallowEmpty:!0})),t.hasComponent(f)?m("textarea",{oninput:c,value:t.getComponent(f).markdown,placeholder:"Enter Markdown text here",style:{marginLeft:"var(--padding)",padding:"var(--padding)",outline:"0",height:`${u(t.getComponent(f).markdown)}px`,border:"0"}},t.getComponent(f).markdown):null,m(D,{workspace:i,node:t})))}};var W={view({attrs:{workspace:o}}){return m("div",{style:{position:"absolute",left:"0",right:"0",top:"0",bottom:"0"}},m("div",{onclick:()=>o.closeQuickAdd(),style:{position:"absolute",background:"black",opacity:"50%",width:"100%",height:"100%"}}),m("div",{style:{position:"relative",marginLeft:"auto",marginRight:"auto",width:"45vw",borderRadius:"0.5rem",filter:"drop-shadow(2px 2px 4px #5555)",marginTop:"20vh",padding:"2rem",background:"white"}},m("h3",{style:{margin:"0"}},"Quick Add"),m("hr",null),m(D,{workspace:o,node:o.quickadd}),m("hr",null),m("div",{style:{textAlign:"right"}},m("button",{style:{padding:"0.5rem",margin:"0.25rem"},onclick:()=>{o.commitQuickAdd(),o.closeQuickAdd()}},"Add to Today"))))}};var Q={onupdate({state:o,dom:e}){let i=e.querySelector(".results");i&&o.selected!==void 0&&i.children.length>0&&i.children[o.selected].scrollIntoView({block:"nearest"})},view({attrs:{workspace:o},state:e}){e.query=e.query===void 0?"":e.query;let i=[];e.query&&(i=o.backend.index.search(e.query).map(s=>{let d=o.nodes.find(s);if(d&&!(d.getValue()&&(d=d.getParent(),!d.raw)))return d}).filter(s=>s!==void 0));let t=s=>{o.open(s),e.query=""},n=s=>{let d=(l,c)=>(l%c+c)%c;if(s.key==="ArrowDown"){if(e.selected===void 0){e.selected=0;return}return e.selected=d(e.selected+1,i.length),!1}if(s.key==="ArrowUp")return e.selected===void 0&&(e.selected=0),e.selected=d(e.selected-1,i.length),!1;if(s.key==="Enter")return e.selected!==void 0&&t(i[e.selected]),!1;s.key==="Escape"&&(e.query="")},r=s=>{e.query=s.target.value,e.selected=0};return m("div",{class:"search",style:{position:"relative",display:"flex",flexGrow:"1",padding:"calc(var(--padding)/2)"}},m("div",{style:{width:"95%",padding:"calc(var(--padding)/2)",borderRadius:"0.25rem",border:i.length>0?"1px solid var(--dark)":"none",position:"absolute",background:i.length>0?"white":null}},m("input",{type:"text",placeholder:"Search",value:e.query,onkeydown:n,oninput:r,style:{width:"99%",border:"0",outline:"0",background:"transparent",marginRight:"var(--padding)"}}),i.length>0?m("div",{class:"results",style:{marginTop:"0.25rem",overflowX:"hidden",overflowY:"auto",maxHeight:"400px"}},i.map((s,d)=>m("div",{onclick:()=>t(s),class:e.selected===d?"selected":""},s.getName()))):null))}};var ne={view({attrs:{workspace:o}}){return m("div",null,m("h3",{style:{margin:"0"}},"Treehouse is under active development!"),m("hr",null),m("p",null,"This is a preview based on our main branch, it may have bugs. Please report them."),m("p",null,"Data is stored using localstorage, which you can reset with Reset Demo in the",m("svg",{xmlns:"http://www.w3.org/2000/svg",style:{display:"inline",marginLeft:"0.5rem",marginRight:"0.5rem"},width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},m("path",{d:"M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872l-.1-.34zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"})),"menu in the top right."),m("hr",null),m("div",{style:{textAlign:"right"}},m("button",{style:{padding:"0.5rem",margin:"0.25rem",fontSize:"1.25rem"},onclick:()=>{localStorage.setItem("firsttime","1"),o.hideNotice()}},"Got it")))}},ie={view({attrs:{workspace:o,finished:e}}){return m("div",null,m("h3",{style:{margin:"0"}},"Login with GitHub"),m("hr",null),m("p",null,"The GitHub backend is experimental so use at your own risk!"),m("p",null,"To store your workspace we will create a public repository called ",m("pre",{style:{display:"inline"}},"<username>.treehouse.sh")," if it doesn't already exist. You can manually make this repository private via GitHub if you want."),m("p",null,"You can Logout via the",m("svg",{xmlns:"http://www.w3.org/2000/svg",style:{display:"inline",marginLeft:"0.5rem",marginRight:"0.5rem"},width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},m("path",{d:"M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872l-.1-.34zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"})),"menu in the top right to return to the localstorage backend."),m("hr",null),m("div",{style:{textAlign:"right"}},m("button",{style:{padding:"0.5rem",margin:"0.25rem",fontSize:"1.25rem"},onclick:()=>{o.hideNotice(),localStorage.setItem("github","1"),e()}},"Login with GitHub"),m("button",{style:{padding:"0.5rem",margin:"0.25rem",fontSize:"1.25rem"},onclick:()=>{o.hideNotice()}},"Cancel")))}},Y={view({attrs:{workspace:o,message:e,finished:i}}){return m("div",{style:{position:"absolute",left:"0",right:"0",top:"0",bottom:"0"}},m("div",{onclick:()=>o.hideNotice(),style:{position:"absolute",background:"black",opacity:"50%",width:"100%",height:"100%"}}),m("div",{style:{position:"relative",marginLeft:"auto",marginRight:"auto",fontSize:"1.25rem",width:"680px",borderRadius:"0.5rem",filter:"drop-shadow(2px 2px 4px #5555)",marginTop:"20vh",padding:"2rem",background:"white"}},m({firsttime:ne,github:ie}[e],{workspace:o,finished:i})))}};var K={view({attrs:{workspace:o},state:e}){e.open=e.open===void 0?!0:e.open;let i=t=>{e.open?e.open=!1:e.open=!0};return m("main",{style:{margin:"0",display:"flex",flexDirection:"column",position:"absolute",top:"0",bottom:"0",left:"0",right:"0"}},m("div",{style:{display:"flex",borderBottom:"1px solid var(--dark)"}},e.open&&m("div",{style:{width:"200px",display:"flex",padding:"var(--padding)"}},m("div",{style:{flexGrow:"1"}},m("img",{src:"/icon_transparent.png",style:{opacity:"70%",width:"16px",height:"16px"}})),m("svg",{onclick:i,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-layout-sidebar",viewBox:"0 0 16 16"},m("path",{d:"M0 3a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3zm5-1v12h9a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1H5zM4 2H2a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h2V2z"}))),m("div",{style:{flexGrow:"1",display:"flex"}},!e.open&&m("svg",{onclick:i,style:{padding:"var(--padding)",borderLeft:"1px solid var(--dark)"},xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-layout-sidebar",viewBox:"0 0 16 16"},m("path",{d:"M0 3a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3zm5-1v12h9a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1H5zM4 2H2a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h2V2z"})),m("div",{style:{borderLeft:"1px solid var(--dark)"}}),m("div",{onclick:()=>o.openToday(),style:{cursor:"pointer",padding:"var(--padding)",display:"flex",alignItems:"center"}},m("svg",{style:{marginRight:"0.25rem",height:"1rem",width:"1rem"},xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 16 16"},m("path",{d:"M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM2 2a1 1 0 0 0-1 1v11a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1H2z"}),m("path",{d:"M2.5 4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5H3a.5.5 0 0 1-.5-.5V4z"}),m("text",{"text-anchor":"middle",x:"8",y:"13",style:{fontSize:"0.55rem"}},new Date().getDate())),m("div",null,"Today")),m("div",{style:{borderLeft:"1px solid var(--dark)"}}),m("div",{onclick:()=>o.openQuickAdd(),style:{cursor:"pointer",padding:"var(--padding)",display:"flex",alignItems:"center"}},m("svg",{style:{marginRight:"0.25rem",height:"1rem",width:"1rem"},xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 16 16"},m("path",{d:"M11.251.068a.5.5 0 0 1 .227.58L9.677 6.5H13a.5.5 0 0 1 .364.843l-8 8.5a.5.5 0 0 1-.842-.49L6.323 9.5H3a.5.5 0 0 1-.364-.843l8-8.5a.5.5 0 0 1 .615-.09zM4.157 8.5H7a.5.5 0 0 1 .478.647L6.11 13.59l5.732-6.09H9a.5.5 0 0 1-.478-.647L9.89 2.41 4.157 8.5z"})),m("div",null,"Quick Add")),m("div",{style:{borderLeft:"1px solid var(--dark)"}}),m(Q,{workspace:o}),m("div",{style:{borderLeft:"1px solid var(--dark)"}}),m("div",{style:{padding:"var(--padding)"}},m("svg",{onclick:t=>o.showMenu(t),"data-menu":"settings","data-align":"right",style:{cursor:"pointer"},xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},m("path",{d:"M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872l-.1-.34zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"}))))),m("div",{style:{display:"flex",flexGrow:"1"}},e.open&&m("div",{style:{width:"200px",padding:"var(--padding)"}},o.nodes.getRoot().getChildren().map(t=>m(_,{node:t,expanded:!0,level:0,workspace:o}))),m("div",{style:{flexGrow:"1",borderLeft:"1px solid var(--dark)"}},o.panels.map(t=>m("div",{style:{display:"flex"}},t.map(n=>m(G,{workspace:o,panel:n})))))),o.menu&&m($,{workspace:o,...o.menu}),o.palette&&m(j,{workspace:o,...o.palette}),o.quickadd&&m(W,{workspace:o}),o.notice&&m(Y,{workspace:o,...o.notice}))}},_={view({attrs:{node:o,workspace:e,expanded:i,level:t},state:n}){n.expanded=n.expanded===void 0?i:n.expanded;let r=o.childCount()>0&&t<2,s=l=>{r&&(n.expanded?n.expanded=!1:n.expanded=!0,l.stopPropagation())},d=l=>{e.open(o)};return m("div",null,m("div",{style:{display:"flex",paddingBottom:"0.125rem",paddingTop:"0.125rem"}},m("svg",{onclick:s,style:{cursor:"pointer",flexShrink:"0",width:"1rem",height:"1rem",marginRight:"0.25rem",paddingLeft:"1px"},xmlns:"http://www.w3.org/2000/svg",fill:"gray",viewBox:"0 0 16 16"},r?n.expanded?m("path",{d:"M3.204 5h9.592L8 10.481 3.204 5zm-.753.659 4.796 5.48a1 1 0 0 0 1.506 0l4.796-5.48c.566-.647.106-1.659-.753-1.659H3.204a1 1 0 0 0-.753 1.659z"}):m("path",{d:"M6 12.796V3.204L11.481 8 6 12.796zm.659.753 5.48-4.796a1 1 0 0 0 0-1.506L6.66 2.451C6.011 1.885 5 2.345 5 3.204v9.592a1 1 0 0 0 1.659.753z"}):null),m("div",{onclick:d,style:{cursor:"pointer",lineHeight:"1.45",fontSize:"0.875rem",flexGrow:"1",maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},o.getName())),n.expanded&&m("div",{style:{marginLeft:"0.5rem"}},o.getChildren().filter(l=>l.getName()!=="").map(l=>m(_,{workspace:e,node:l,level:t+1}))))}};var b=class{constructor(){this.auth=null,this.files=new E,this.nodes=new R(this.files),window.MiniSearch?this.index=new P:this.index=new B}},P=class{constructor(){this.indexer=new MiniSearch({idField:"ID",fields:["ID","Name","Value.markdown"],storeFields:["ID"],extractField:(e,i)=>i.split(".").reduce((t,n)=>t&&t[n],e)})}index(e){this.indexer.has(e.ID)?this.indexer.replace(e):this.indexer.add(e)}remove(e){this.indexer.discard(e)}search(e){let i=this.indexer.autoSuggest(e);return i.length===0?[]:this.indexer.search(i[0].suggestion).map(t=>t.ID)}},B=class{constructor(){this.nodes={}}index(e){this.nodes[e.ID]=e.Name}remove(e){delete this.nodes[e]}search(e){let i=[];for(let t in this.nodes)this.nodes[t].includes(e)&&i.push(t);return i}},R=class{constructor(e){this.files=e}async loadAll(){return JSON.parse(await this.files.readFile("workspace.json")||"[]")}async saveAll(e){await this.files.writeFile("workspace.json",JSON.stringify(e))}},E=class{async readFile(e){return localStorage.getItem(`treehouse:${e}`)}async writeFile(e,i){localStorage.setItem(`treehouse:${e}`,i)}};var z=class{constructor(e,i){this.loginURL=e,this.clientFactory=i,this.auth=this,this.shas={};let t=new b;this.index=t.index,this.nodes=t.nodes,this.files=t.files,this.writeDebounce=oe((n,r)=>{console.log("Saving workspace..."),this.writeFile(n,r)})}get repo(){return`${this.user?.userID()}.treehouse.sh`}async initialize(){let e=new URL(location.href).searchParams.get("code");if(e)try{let i=location.search.replace(/\bcode=\w+/,"").replace(/\?$/,"");history.pushState({},"",`${location.pathname}${i}`);let n=await(await fetch(this.loginURL,{method:"POST",mode:"cors",headers:{"content-type":"application/json"},body:JSON.stringify({code:e})})).json();if(n.error)throw n.error;localStorage.setItem("treehouse:gh-token",n.token)}catch(i){this.reset(),console.error(i);return}if(await this.authenticate(),!this.user){console.error("authentication failed");return}try{await this.client.rest.repos.get({owner:this.user.userID(),repo:this.repo})}catch(i){if(i.message!=="Not Found")throw i;console.log("Creating repository...");let t=await this.client.rest.repos.createForAuthenticatedUser({name:this.repo});if(t.status!==201){console.error(t);return}}try{await this.client.rest.repos.getContent({owner:this.user.userID(),repo:this.repo,path:"workspace.json"})}catch(i){if(i.name!=="HttpError")throw i;console.log("Creating workspace.json...");let t=await this.client.rest.repos.createOrUpdateFileContents({owner:this.user.userID(),repo:this.repo,path:"workspace.json",message:"initial commit",content:btoa(JSON.stringify([]))});if(t.status!==201){console.error(t);return}}this.files=this,this.nodes=this}async authenticate(){let e=localStorage.getItem("treehouse:gh-token");if(!e)return;this.client=new this.clientFactory({auth:e});let i=await this.client.rest.users.getAuthenticated();!i||i.error||(this.user=new H(i.data),m&&m.redraw())}currentUser(){return this.user}login(){location.assign(this.loginURL)}reset(){localStorage.removeItem("treehouse:gh-token"),this.user=null,m&&m.redraw()}logout(){this.reset(),location.reload()}async loadAll(){return JSON.parse(await this.readFile("workspace.json")||"[]")}async saveAll(e){this.writeDebounce("workspace.json",JSON.stringify(e,null,2))}async readFile(e){try{let i=await this.client.rest.repos.getContent({owner:this.user?.userID(),repo:this.repo,path:e,random:Math.random().toString(36).substring(2)});return this.shas[e]=i.data.sha,atob(i.data.content)}catch(i){return i.name!=="HttpError"&&console.error(i),null}}async writeFile(e,i){let t=await this.client.rest.repos.createOrUpdateFileContents({owner:this.user?.userID(),repo:this.repo,path:e,message:"autosave",content:btoa(i),sha:this.shas[e]});this.shas[e]=t.data.content.sha}},H=class{constructor(e){this.user=e}userID(){return this.user.login}displayName(){return this.user.name}avatarURL(){return this.user.avatar_url}};function oe(o,e=3e3){let i;return(...t)=>{clearTimeout(i),i=setTimeout(()=>{o.apply(this,t)},e)}}var p=class{constructor(){this.checked=!1}};p=M([L],p);var f=class{constructor(){this.markdown=""}};f=M([L],f);async function Ke(o,e,i){i.initialize&&await i.initialize();let t=new x(i);window.workspace=t,await t.initialize(),t.commands.registerCommand({id:"add-page",title:"Add page",action:n=>{if(!n.node)return;let r=new f;n.node.addComponent(r)}}),t.commands.registerCommand({id:"remove-page",title:"Remove page",action:n=>{n.node&&n.node.removeComponent(f)}}),t.commands.registerCommand({id:"add-checkbox",title:"Add checkbox",action:n=>{if(!n.node)return;let r=new p;n.node.addComponent(r)}}),t.commands.registerCommand({id:"remove-checkbox",title:"Remove checkbox",action:n=>{n.node&&n.node.removeComponent(p)}}),t.commands.registerCommand({id:"mark-done",title:"Mark done",action:n=>{if(n.node)if(n.node.hasComponent(p)){let r=n.node.getComponent(p);r.checked?n.node.removeComponent(p):(r.checked=!0,n.node.changed())}else{let r=new p;n.node.addComponent(r)}}}),t.keybindings.registerBinding({command:"mark-done",key:"meta+enter"}),t.commands.registerCommand({id:"expand",title:"Expand",action:n=>{n.node&&(t.setExpanded(n.node,!0),m.redraw())}}),t.keybindings.registerBinding({command:"expand",key:"meta+arrowdown"}),t.commands.registerCommand({id:"collapse",title:"Collapse",action:n=>{n.node&&(t.setExpanded(n.node,!1),m.redraw())}}),t.keybindings.registerBinding({command:"collapse",key:"meta+arrowup"}),t.commands.registerCommand({id:"indent",title:"Indent",action:n=>{if(!n.node)return;let r=g(n.node.getPrevSibling(),n.node.panel);if(r!==null){n.node.setParent(r),t.setExpanded(r,!0);let s=n.node;m.redraw.sync(),t.focus(s)}}}),t.keybindings.registerBinding({command:"indent",key:"tab"}),t.commands.registerCommand({id:"outdent",title:"Outdent",action:n=>{if(!n.node)return;let r=g(n.node.getParent(),n.node.panel);if(r!==null&&r.ID!=="@root"){n.node.setParent(r.getParent()),n.node.setSiblingIndex(r.getSiblingIndex()+1),r.childCount()===0&&t.setExpanded(r,!1);let s=n.node;m.redraw.sync(),t.focus(s)}}}),t.keybindings.registerBinding({command:"outdent",key:"shift+tab"}),t.commands.registerCommand({id:"insert-child",title:"Insert Child",action:(n,r="")=>{if(!n.node)return;let s=t.nodes.new(r);s.setParent(n.node),t.setExpanded(n.node,!0),m.redraw.sync(),t.focus(g(s,n.node.panel),r.length)}}),t.commands.registerCommand({id:"insert-before",title:"Insert Before",action:n=>{if(!n.node)return;let r=t.nodes.new("");r.setParent(n.node.getParent()),r.setSiblingIndex(n.node.getSiblingIndex()),m.redraw.sync(),t.focus(g(r,n.node.panel))}}),t.commands.registerCommand({id:"insert",title:"Insert Node",action:(n,r="")=>{if(!n.node)return;let s=t.nodes.new(r);s.setParent(n.node.getParent()),s.setSiblingIndex(n.node.getSiblingIndex()+1),m.redraw.sync(),t.focus(g(s,n.node.panel))}}),t.keybindings.registerBinding({command:"insert",key:"shift+enter"}),t.commands.registerCommand({id:"delete",title:"Delete node",action:n=>{if(!n.node)return;let r=n.node.getPrevSibling();if(n.node.destroy(),m.redraw.sync(),r){let s=0;n.event&&n.event.key==="Backspace"&&(s=r.getName().length),t.focus(g(r,n.node.panel),s)}}}),t.keybindings.registerBinding({command:"delete",key:"shift+meta+backspace"}),t.commands.registerCommand({id:"prev",action:n=>{if(!n.node)return;let r=t.findAbove(n.node);r&&t.focus(g(r,n.node.panel))}}),t.keybindings.registerBinding({command:"prev",key:"arrowup"}),t.commands.registerCommand({id:"next",action:n=>{if(!n.node)return;let r=t.findBelow(n.node);r&&t.focus(g(r,n.node.panel))}}),t.keybindings.registerBinding({command:"next",key:"arrowdown"}),t.commands.registerCommand({id:"pick-command",action:n=>{if(!n.node)return;let r=t.getInput(n.node),s=r.getBoundingClientRect(),d=o.body.scrollLeft+s.x+r.selectionStart*10+20,l=o.body.scrollTop+s.y-8;t.showPalette(d,l,t.newContext({node:n.node}))}}),t.keybindings.registerBinding({command:"pick-command",key:"meta+k"}),t.commands.registerCommand({id:"new-panel",title:"Open in New Panel",action:n=>{n.node&&(t.openNewPanel(n.node),m.redraw())}}),t.commands.registerCommand({id:"close-panel",title:"Close Panel",action:(n,r)=>{t.closePanel(r||n.node.panel),m.redraw()}}),t.commands.registerCommand({id:"zoom",title:"Open",action:n=>{n.node.panel.history.push(n.node),m.redraw()}}),t.commands.registerCommand({id:"generate-random",title:"Generate Random Children",action:n=>{n.node&&[...Array(100)].forEach(()=>{t.nodes.new(re(8)).setParent(n.node)})}}),t.menus.registerMenu("node",[{command:"zoom"},{command:"new-panel"},{command:"indent"},{command:"outdent"},{command:"delete"},{command:"add-checkbox"},{command:"remove-checkbox"},{command:"mark-done"},{command:"add-page"},{command:"remove-page"},{command:"generate-random"}]),t.menus.registerMenu("settings",[{title:()=>`${t.backend.auth?.currentUser()?.userID()} @ GitHub`,disabled:!0,when:()=>t.authenticated()},{title:()=>"Login with GitHub",when:()=>!t.authenticated(),onclick:()=>{localStorage.getItem("github")?t.backend.auth.login():t.showNotice("github",()=>{t.backend.auth.login()})}},{title:()=>"Reset Demo",when:()=>!t.authenticated(),onclick:()=>{localStorage.clear(),location.reload()}},{title:()=>"Submit Issue",onclick:()=>window.open("https://github.com/treehousedev/treehouse/issues","_blank")},{title:()=>"Logout",when:()=>t.authenticated(),onclick:()=>t.backend.auth.logout()}]),o.addEventListener("keydown",n=>{let r=t.keybindings.evaluateEvent(n);r&&t.context.node&&(t.commands.executeCommand(r.command,t.context),n.stopPropagation(),n.preventDefault())}),o.addEventListener("click",n=>{t.hideMenu()}),m.mount(e,{view:()=>m(K,{workspace:t})})}function re(o=10){let e=(n,r)=>Math.round(Math.random()*(r-n)+n),i=()=>{let n=["got","ability","shop","recall","fruit","easy","dirty","giant","shaking","ground","weather","lesson","almost","square","forward","bend","cold","broken","distant","adjective"];return n[e(0,n.length-1)]};return(n=>[...Array(n)].map((r,s)=>i()).join(" ").trim())(e(2,o))}export{b as BrowserBackend,p as Checkbox,z as GitHubBackend,f as Page,P as SearchIndex_MiniSearch,Ke as setup};
