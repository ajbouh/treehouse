var ee=Object.defineProperty;var te=Object.getOwnPropertyDescriptor;var A=(o,e,n,t)=>{for(var i=t>1?void 0:t?te(e,n):e,r=o.length-1,s;r>=0;r--)(s=o[r])&&(i=(t?s(e,n,i):s(i))||i);return t&&i&&ee(e,n,i),i};var O=navigator.userAgent.toLowerCase().indexOf("mac")!==-1;function V(o){if(!o)return[];let e={backspace:"\u232B",shift:"\u21E7",meta:"\u2318",tab:"\u21B9",ctrl:"\u2303",uparrow:"\u2191",downarrow:"\u2193",leftarrow:"\u2190",rightarrow:"\u2192",enter:"\u23CE"};return o.toLowerCase().split("+").map($).map(t=>Object.keys(e).includes(t)?e[t]:t)}function $(o){return!O&&o==="meta"?"ctrl":o}var N=class{constructor(){this.bindings=[]}registerBinding(e){this.bindings.push(e)}getBinding(e){for(let n of this.bindings)if(n.command===e)return n;return null}evaluateEvent(e){e:for(let n of this.bindings){let t=n.key.toLowerCase().split("+");if(t.pop()===e.key.toLowerCase()){for(let r of["shift","ctrl","alt","meta"]){let s=t.includes(r);if(!O){if(r==="meta")continue;r==="ctrl"&&(s=t.includes("meta")||t.includes("ctrl"))}let d=e[`${$(r)}Key`];if(!d&&s||d&&!s)continue e}return n}}return null}};var I=class{constructor(){this.commands={}}registerCommand(e){this.commands[e.id]=e}executeCommand(e,...n){return this.commands[e].action(...n)}};var ne={};function B(o){let e=new Error().stack;if(e){let t=e.split(`
`)[3].split("/").pop()?.split(".")[0];o.__module=t}ne[x(o)]=o}function x(o){return o.constructor&&o.constructor.__module&&(o=o.constructor),o.__module?`${o.__module}.${o.name}`:o.name}var w=class{constructor(e,n){this.module=e,this.ID=n}changed(){this.module.changed(this)}get isDestroyed(){return!this.module.nodes.hasOwnProperty(this.ID)}get raw(){return this.module.nodes[this.ID]}getName(){return this.raw.Name}setName(e){this.raw.Name=e,this.changed()}getValue(){return this.raw.Value}getParent(){return this.raw.Parent?new w(this.module,this.raw.Parent):null}setParent(e){let n=this.getParent();n!==null&&n.raw.Linked.Children.splice(this.getSiblingIndex(),1),this.raw.Parent=e.ID,e.raw.Linked.Children.push(this.ID),this.changed()}getChildren(){return this.raw.Linked.Children?this.raw.Linked.Children.map(e=>new w(this.module,e)):[]}childCount(){return this.raw.Linked.Children?this.raw.Linked.Children.length:0}getAttr(e){return this.raw.Attrs[e]||""}setAttr(e,n){this.raw.Attrs[e]=n,this.changed()}getSiblingIndex(){let e=this.getParent();return e===null?0:e.raw.Linked.Children.findIndex(n=>n===this.ID)}setSiblingIndex(e){let n=this.getParent();n!==null&&(n.raw.Linked.Children.splice(this.getSiblingIndex(),1),n.raw.Linked.Children.splice(e,0,this.ID),n.changed())}getPrevSibling(){let e=this.getParent();return e===null||this.getSiblingIndex()===0?null:e.getChildren()[this.getSiblingIndex()-1]}getNextSibling(){let e=this.getParent();return e===null||this.getSiblingIndex()===e.getChildren().length-1?null:e.getChildren()[this.getSiblingIndex()+1]}destroy(){this.module.destroy(this)}addComponent(e){let n=this.module.new(x(e),e);n.raw.Parent=this.ID,this.raw.Linked.Components.push(n.ID),this.changed()}removeComponent(e){let n=this.getComponentNodes().filter(t=>t.getName()===x(e));n.length>0&&n[0].destroy(),this.changed()}hasComponent(e){return this.getComponentNodes().filter(t=>t.getName()===x(e)).length>0}getComponent(e){let n=this.getComponentNodes().filter(t=>t.getName()===x(e));return n.length>0?n[0].getValue():null}getComponentNodes(){return this.raw.Linked.Components?this.raw.Linked.Components.map(e=>new w(this.module,e)):[]}getPath(){let e=this,n=[];for(;e;)n.unshift(e.getName()),e=e.getParent();return n.join("/")}find(e){return this.module.find([this.getPath(),e].join("/"))}},S=class{constructor(){this.nodes={"@root":{ID:"@root",Name:"@root",Linked:{Children:[],Components:[]},Attrs:{}}},this.observers=[]}import(e){for(let n of e)this.nodes[n.ID]=n}export(){let e=[];for(let n of Object.values(this.nodes))e.push(n);return e}new(e,n){let t=null;if(e.includes("/")&&!e.startsWith("@")){let s=e.split("/");t=this.getRoot();for(let d=0;d<s.length-1;d++){if(t===null)throw"unable to get root";let l=t.find(s[d]);l||(l=this.new(s.slice(0,d+1).join("/"))),t=l}e=s[s.length-1]}let i=e.startsWith("@")?e:ie();this.nodes[i]={ID:i,Name:e,Value:n,Linked:{Children:[],Components:[]},Attrs:{}};let r=new w(this,i);return t&&r.setParent(t),r}destroy(e){let n=e.getParent();n!==null&&(n.raw.Linked.Children.includes(e.ID)&&n.raw.Linked.Children.splice(e.getSiblingIndex(),1),n.raw.Linked.Components.includes(e.ID)&&n.raw.Linked.Components.splice(e.getSiblingIndex(),1)),delete this.nodes[e.ID],n&&this.changed(n)}roots(){return Object.values(this.nodes).filter(e=>e.Parent===void 0).map(e=>new w(this,e.ID))}changed(e){this.observers.forEach(n=>n(e))}getRoot(e){e=e||"@root";let n=this.roots().find(t=>t.getName()===e);return n===void 0?null:n}find(e){let n=this.nodes[e];if(n)return new w(this,n.ID);let t=e.split("/"),i="@root";if(t[0].startsWith("@")&&(i=t.shift()||"",t.length===0))return this.getRoot(i);let r=(d,l)=>d.getChildren().find(c=>c.getName()===l),s=this.getRoot(i);if(!s)return null;for(let d of t){let l=r(s,d);if(!l)return null;s=l}return s}walk(e){let n=(t,i)=>{if(i(t))return!0;for(let r of t.getChildren())if(n(r,i))return!0;return!1};for(let t of this.roots())if(n(t,e))return}},ie=()=>{let o=Date.now().toString(36),e=Math.random().toString(36).substring(2);return o+e};var D=class{constructor(){this.menus={}}registerMenu(e,n){this.menus[e]=n}};var P=class{constructor(e){e.panel=this,this.id=Math.random().toString(36).substring(2),this.history=[e]}get current(){return this.history[this.history.length-1]}};function g(o,e){return o.panel=e,o}var k=class{constructor(e){this.commands=new I,this.keybindings=new N,this.menus=new D,this.backend=e,this.nodes=new S,this.context={node:null},this.panels=[[]],this.expanded={}}async initialize(){let e=await this.backend.nodes.loadAll(),n=this.nodes.find("@root");if(e.length===0){let t=this.nodes.new("Workspace");t.setParent(n),this.nodes.new("Calendar").setParent(t),this.nodes.new("Home").setParent(t)}this.nodes.import(e),this.nodes.observers.push(t=>{this.backend.nodes.saveAll(Object.values(this.nodes.nodes)),this.backend.index.index(t.raw),t.getComponentNodes().forEach(i=>this.backend.index.index(i.raw))}),Object.values(this.nodes.nodes).forEach(t=>this.backend.index.index(t)),this.openNewPanel(this.nodes.find("@root/Workspace")),m.redraw(),localStorage.getItem("firsttime")||this.showNotice("firsttime")}authenticated(){return this.backend.auth&&this.backend.auth.currentUser()}closeQuickAdd(){this.quickadd=null,m.redraw()}openQuickAdd(){let e=this.nodes.find("@quickadd");e||(e=this.nodes.new("@quickadd")),this.quickadd=e}commitQuickAdd(){let e=this.nodes.find("@quickadd");if(!e)return;let n=this.todayNode();e.getChildren().forEach(t=>t.setParent(n))}clearQuickAdd(){let e=this.nodes.find("@quickadd");e&&e.getChildren().forEach(n=>n.destroy())}todayNode(){let e=new Date,n=e.toUTCString().split(e.getFullYear())[0],t=`Week ${String(oe(e)).padStart(2,"0")}`,r=["Workspace","Calendar",`${e.getFullYear()}`,t,n].join("/"),s=this.nodes.find(r);return s||(s=this.nodes.new(r)),s}openToday(){this.open(this.todayNode())}open(e){this.expanded[e.ID]||(this.expanded[e.ID]={}),localStorage.setItem("lastopen",e.ID),this.panels[0][0]=new P(e)}openNewPanel(e){this.expanded[e.ID]={},localStorage.setItem("lastopen",e.ID);let n=new P(e);this.panels[0].push(n)}closePanel(e){this.panels.forEach((n,t)=>{this.panels[t]=n.filter(i=>i!==e)})}focus(e,n=0){this.context.node=e,e&&(document.getElementById(`input-${e.panel?.id}-${e.ID}`)?.focus(),document.getElementById(`input-${e.panel?.id}-${e.ID}`)?.setSelectionRange(n,n))}getInput(e){return document.getElementById(`input-${e.panel?.id}-${e.ID}`)}executeCommand(e,n,...t){return this.commands.executeCommand(e,this.newContext(n),...t)}newContext(e){return Object.assign({},this.context,e)}showMenu(e,n){e.stopPropagation(),e.preventDefault();let t=e.target.closest("*[data-menu]"),i=t.getBoundingClientRect(),r=t.dataset.align||"left",s=document.body.scrollLeft+i.x;r==="right"&&(s=window.innerWidth-i.right-i.width);let d=document.body.scrollTop+i.y+i.height,l=this.menus.menus[t.dataset.menu],c=l.filter(h=>h.command).map(h=>this.commands.commands[h.command]);l&&(this.menu={x:s,y:d,ctx:this.newContext(n),items:l,commands:c,align:r},m.redraw())}hideMenu(){this.menu=null,m.redraw()}showPalette(e,n,t){this.palette={x:e,y:n,ctx:t},m.redraw()}hidePalette(){this.palette=null,m.redraw()}showNotice(e,n){this.notice={message:e,finished:n},m.redraw()}hideNotice(){this.notice=null,m.redraw()}getExpanded(e){let n=e.ID;e.panel&&(n=e.panel.history[0].ID),this.expanded[n]||(this.expanded[n]={});let t=this.expanded[n][e.ID];return t===void 0&&(t=!1),t}setExpanded(e,n){this.expanded[e.panel.history[0].ID][e.ID]=n}};function oe(o){var e=new Date(Date.UTC(o.getFullYear(),o.getMonth(),o.getDate())),n=e.getUTCDay()||7;e.setUTCDate(e.getUTCDate()+4-n);var t=new Date(Date.UTC(e.getUTCFullYear(),0,1));return Math.ceil(((e-t)/864e5+1)/7)}var j={view({attrs:{workspace:o,x:e,y:n,items:t,align:i,commands:r,ctx:s}}){let d=(c,h)=>u=>{u.stopPropagation(),!c.disabled&&(c.onclick&&c.onclick(),h&&o.executeCommand(h.id,s),o.hideMenu())},l={left:`${e}px`};return i==="right"&&(l={right:`${e}px`}),m("ul",{class:"menu",style:Object.assign(l,{margin:"0",position:"absolute",top:`${n}px`,border:"1px solid var(--dark)",borderRadius:"0.25rem",padding:"0.25rem 0 0.25rem 0",display:"inline-block",background:"white",filter:"drop-shadow(2px 2px 4px #5555)",fontSize:"14px",minWidth:"200px"})},t.filter(c=>!c.when||c.when()).map(c=>{let h="",u,v;return c.command&&(v=r.find(C=>C.id===c.command),u=o.keybindings.getBinding(v.id),h=v.title),c.title&&(h=c.title()),m("li",{onclick:d(c,v),class:c.disabled?"disabled":"",style:{margin:"0px",listStyleType:"none",padding:"0.25rem 0.5rem 0.25rem 0.5rem",display:"flex"}},m("div",null,h),u&&m("div",{style:{flexGrow:"1",textAlign:"right",color:"#888",marginLeft:"1rem"}},V(u.key).join(" ").toUpperCase()))}))}};var q={onupdate({state:o,dom:e}){let n=e.querySelector(".commands").children;o.selected!==void 0&&n.length>0&&n[o.selected].scrollIntoView({block:"nearest"})},oncreate({dom:o}){o.querySelector("input").focus()},view({attrs:o,state:e}){let n=o.workspace;e.filter=e.filter===void 0?"":e.filter;let i=Object.values(n.commands.commands).filter(d=>d.id.startsWith(e.filter)),r=d=>{let l=(c,h)=>(c%h+h)%h;if(d.key==="ArrowDown"){if(e.selected===void 0){e.selected=0;return}return e.selected=l(e.selected+1,i.length),!1}if(d.key==="ArrowUp")return e.selected===void 0&&(e.selected=0),e.selected=l(e.selected-1,i.length),!1;if(d.key==="Enter")return e.selected!==void 0&&(n.commands.executeCommand(i[e.selected].id,o.ctx),n.hidePalette()),!1;d.key==="Escape"&&n.hidePalette()},s=d=>{e.filter=d.target.value,e.selected=0};return m("div",{class:"palette",style:{margin:"0",position:"absolute",left:`${o.x}px`,top:`${o.y}px`,border:"1px solid var(--dark)",borderRadius:"0.25rem",padding:"0.5rem",background:"white",fontSize:"14px",minWidth:"400px"}},m("div",null,m("input",{style:{width:"98%",outline:"0",border:"0"},type:"text",onkeydown:r,oninput:s,placeholder:"Enter command..."})),m("div",{class:"commands",style:{margin:"0.25rem",overflowY:"scroll",maxHeight:"200px",position:"relative"}},i.map((d,l)=>m("div",{style:{padding:"0.25rem"},class:e.selected===l?"selected":""},d.title||d.id))))}};var G={view({attrs:o,state:e,children:n}){let{node:t,workspace:i}=o,r=i.getExpanded(t),s=a=>{e.hover=!0,a.stopPropagation()},d=a=>{e.hover=!1,a.stopPropagation()},l=a=>{r?i.executeCommand("collapse",{node:t}):i.executeCommand("expand",{node:t}),a.stopPropagation()},c=a=>{i.context.node=t,e.editing=!0,e.buffer=t.getName()},h=a=>{e.editing=!1,t.isDestroyed||t.setName(e.buffer),e.buffer=void 0,i.context.node=null},u=a=>{e.buffer=a.target.value,t.setName(e.buffer)},v=a=>{a.stopPropagation(),a.preventDefault(),i.executeCommand("insert-child",{node:t},a.target.value)},C=a=>{switch(a.key){case"Backspace":if(a.target.value===""){a.preventDefault(),t.getParent().ID===t.panel.current.ID?i.executeCommand("delete",{node:t,event:a}):i.executeCommand("outdent",{node:t}),a.stopPropagation();return}if(a.target.value!==""&&a.target.selectionStart===0&&a.target.selectionEnd===0){a.preventDefault();let y=t.getPrevSibling(),F=y.getName();y.setName(F+a.target.value),t.destroy(),m.redraw.sync(),i.focus(g(y,t.panel),F.length),a.stopPropagation();return}break;case"Enter":if(a.ctrlKey||a.shiftKey||a.metaKey||a.altKey)return;if(a.target.selectionStart===a.target.value.length){i.executeCommand("insert",{node:t}),a.stopPropagation();return}if(a.target.selectionStart===0){i.executeCommand("insert-before",{node:t}),a.stopPropagation();return}if(a.target.selectionStart>0&&a.target.selectionStart<a.target.value.length){e.buffer=a.target.value.slice(0,a.target.selectionStart),i.executeCommand("insert",{node:t},a.target.value.slice(a.target.selectionStart)),a.stopPropagation();return}break}},J=a=>{let y=t.getComponent(p);y.checked=!y.checked,t.changed()},X=a=>{a.preventDefault(),a.stopPropagation(),i.executeCommand("zoom",{node:t}),document.selection&&document.selection.empty?document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges()};return m("div",{style:{paddingLeft:"1rem"},onmouseover:s,onmouseout:d},m("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",marginTop:"0.125rem",marginBottom:"0.125rem"}},m("svg",{xmlns:"http://www.w3.org/2000/svg",style:{cursor:"pointer",flexShrink:"0",width:"1rem",height:"1rem",position:"absolute",marginLeft:"-1rem",userSelect:"none",display:e.hover?"block":"none"},onclick:a=>i.showMenu(a,{node:t}),oncontextmenu:a=>i.showMenu(a,{node:t}),"data-menu":"node",fill:"lightgray",viewBox:"0 0 16 16"},m("path",{style:{transform:"translateY(-1px)"},"fill-rule":"evenodd",d:"M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z"})),m("svg",{onclick:l,ondblclick:X,oncontextmenu:a=>i.showMenu(a,{node:t}),"data-menu":"node",style:{cursor:"pointer",flexShrink:"0",width:"1rem",height:"1rem",marginRight:"0.5rem",paddingLeft:"1px"},xmlns:"http://www.w3.org/2000/svg",fill:"gray",viewBox:"0 0 16 16"},t.childCount()>0&&!r?m("circle",{cx:"8",cy:"7",r:"7",fill:"lightgray"}):null,m("circle",{cx:"8",cy:"7",r:"3"})),m("div",{style:{flexGrow:"1",display:"flex"}},t.hasComponent(p)?m("input",{type:"checkbox",onclick:J,checked:t.getComponent(p).checked}):null,m("input",{id:`input-${t.panel?.id}-${t.ID}`,type:"text",value:e.editing?e.buffer:t.getName(),onfocus:c,onblur:h,oninput:u,onkeydown:C,style:{border:"0px",flexGrow:"1",outline:"0px"}}))),m("div",{style:{display:r?"flex":"none",flexDirection:"row",paddingBottom:"0.25rem"}},m("div",{style:{width:"1rem",marginRight:"0.25rem",display:"flex"},onclick:l},m("div",{style:{borderLeft:"1px solid gray",height:"100%",marginLeft:"0.5rem"}})),m("div",{style:{flexGrow:"1"}},t.childCount()>0?t.getChildren().map(a=>m(G,{key:a.ID,workspace:i,node:g(a,t.panel)})):m(U,{workspace:i,node:t}))))}},U={view({attrs:{workspace:o,node:e}}){return m("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",paddingLeft:"1rem",marginTop:"0.125rem",marginBottom:"0.125rem"}},m("svg",{style:{flexShrink:"0",width:"1rem",height:"1rem",marginRight:"0.5rem",paddingLeft:"1px"},xmlns:"http://www.w3.org/2000/svg",fill:"gray",viewBox:"0 0 16 16"},m("circle",{cx:"8",cy:"7",r:"7",fill:"lightgray"}),m("path",{fill:"#555",style:{transform:"translate(0px, -1px)"},d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"})),m("div",{style:{flexGrow:"1",display:"flex"}},m("input",{type:"text",oninput:i=>{o.executeCommand("insert-child",{node:e},i.target.value)},onkeydown:i=>{if(i.key==="Tab"&&(i.stopPropagation(),i.preventDefault(),e.childCount()>0)){let r=e.getChildren()[e.childCount()-1];o.executeCommand("insert-child",{node:g(r,e.panel)})}},value:"",style:{border:"0px",flexGrow:"1",outline:"0px"}})))}},M={view({attrs:{workspace:o,node:e},state:n}){return m("div",{style:{padding:"var(--padding)"}},e.getChildren().map(t=>m(G,{key:t.ID,workspace:o,node:g(t,e.panel)})),m(U,{workspace:o,node:e}))}};var W={view({attrs:o}){let e=o.panel,n=o.workspace,t=e.history[e.history.length-1],i=u=>{n.executeCommand("close-panel",{},e)},r=u=>{e.history.pop()},s=u=>{n.panels=[[e]]},d=u=>{n.closePanel(e),n.panels.push([e])},l=u=>{n.closePanel(e),n.panels.unshift([e])},c=u=>{t.getComponent(f).markdown=u.target.value,t.changed()};function h(u=""){return 20+(u.match(/\n/g)||[]).length*20}return m("div",{style:{display:"flex",flexDirection:"column",flexGrow:"1",margin:"var(--padding)",paddingBottom:"var(--padding)",height:"92vh"}},m("div",{style:{display:"flex",background:"white",borderRadius:"0.5rem",color:"gray",padding:"var(--padding)",paddingTop:"0.5rem",paddingBottom:"0.5rem",gap:"var(--padding)",marginBottom:"0.5rem"}},e.history.length>1?m("div",{style:{rightPadding:"var(--padding)"}},m("svg",{onclick:r,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},m("path",{"fill-rule":"evenodd",d:"M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"}))):null,m("div",{style:{flexGrow:"1"}},t.getParent()&&t.getParent().ID!=="@root"?m("span",{style:{cursor:"pointer"},onclick:()=>n.open(t.getParent())},t.getParent().getName()):null),n.panels.flat().length>1?m("div",{style:{display:"flex",gap:"0.5rem"}},m("svg",{onclick:d,style:{cursor:"pointer",transform:"scaleY(-1)"},xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},m("path",{d:"M2.375 1A2.366 2.366 0 0 0 0 3.357v9.286A2.366 2.366 0 0 0 2.375 15h11.25A2.366 2.366 0 0 0 16 12.643V3.357A2.366 2.366 0 0 0 13.625 1H2.375ZM1 3.357C1 2.612 1.611 2 2.375 2h11.25C14.389 2 15 2.612 15 3.357V4H1v-.643ZM1 5h14v7.643c0 .745-.611 1.357-1.375 1.357H2.375A1.366 1.366 0 0 1 1 12.643V5Z"})),m("svg",{onclick:l,style:{cursor:"pointer"},xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},m("path",{d:"M2.375 1A2.366 2.366 0 0 0 0 3.357v9.286A2.366 2.366 0 0 0 2.375 15h11.25A2.366 2.366 0 0 0 16 12.643V3.357A2.366 2.366 0 0 0 13.625 1H2.375ZM1 3.357C1 2.612 1.611 2 2.375 2h11.25C14.389 2 15 2.612 15 3.357V4H1v-.643ZM1 5h14v7.643c0 .745-.611 1.357-1.375 1.357H2.375A1.366 1.366 0 0 1 1 12.643V5Z"})),m("svg",{onclick:s,style:{cursor:"pointer",transform:"scale(0.9)"},xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},m("path",{d:"M1.5 1a.5.5 0 0 0-.5.5v4a.5.5 0 0 1-1 0v-4A1.5 1.5 0 0 1 1.5 0h4a.5.5 0 0 1 0 1h-4zM10 .5a.5.5 0 0 1 .5-.5h4A1.5 1.5 0 0 1 16 1.5v4a.5.5 0 0 1-1 0v-4a.5.5 0 0 0-.5-.5h-4a.5.5 0 0 1-.5-.5zM.5 10a.5.5 0 0 1 .5.5v4a.5.5 0 0 0 .5.5h4a.5.5 0 0 1 0 1h-4A1.5 1.5 0 0 1 0 14.5v-4a.5.5 0 0 1 .5-.5zm15 0a.5.5 0 0 1 .5.5v4a1.5 1.5 0 0 1-1.5 1.5h-4a.5.5 0 0 1 0-1h4a.5.5 0 0 0 .5-.5v-4a.5.5 0 0 1 .5-.5z"})),m("svg",{onclick:i,style:{cursor:"pointer"},xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},m("path",{d:"M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"}))):null),m("div",{style:{background:"white",borderRadius:"0.5rem",display:"flex",flexDirection:"column"}},m("div",{oncontextmenu:u=>n.showMenu(u,{node:t}),"data-menu":"node",style:{padding:"var(--padding)",fontSize:"2rem"}},t.getName()),t.hasComponent(f)?m("textarea",{oninput:c,value:t.getComponent(f).markdown,placeholder:"Enter Markdown text here",style:{marginLeft:"var(--padding)",padding:"var(--padding)",outline:"0",height:`${h(t.getComponent(f).markdown)}px`,border:"0"}},t.getComponent(f).markdown):null,m(M,{workspace:n,node:t})))}};var Q={view({attrs:{workspace:o}}){return m("div",{style:{position:"absolute",left:"0",right:"0",top:"0",bottom:"0"}},m("div",{onclick:()=>o.closeQuickAdd(),style:{position:"absolute",background:"black",opacity:"50%",width:"100%",height:"100%"}}),m("div",{style:{position:"relative",marginLeft:"auto",marginRight:"auto",width:"45vw",borderRadius:"0.5rem",filter:"drop-shadow(2px 2px 4px #5555)",marginTop:"20vh",padding:"2rem",background:"white"}},m("h3",{style:{margin:"0"}},"Quick Add"),m("hr",null),m(M,{workspace:o,node:o.quickadd}),m("hr",null),m("div",{style:{textAlign:"right"}},m("button",{style:{padding:"0.5rem",margin:"0.25rem"},onclick:()=>{o.commitQuickAdd(),o.closeQuickAdd()}},"Add to Today"))))}};var Y={onupdate({state:o,dom:e}){let n=e.querySelector(".results");n&&o.selected!==void 0&&n.children.length>0&&n.children[o.selected].scrollIntoView({block:"nearest"})},view({attrs:{workspace:o},state:e}){e.query=e.query===void 0?"":e.query;let n=[];e.query&&(n=o.backend.index.search(e.query).map(s=>{let d=o.nodes.find(s);if(d&&!(d.getValue()&&(d=d.getParent(),!d.raw)))return d}).filter(s=>s!==void 0));let t=s=>{o.open(s),e.query=""},i=s=>{let d=(l,c)=>(l%c+c)%c;if(s.key==="ArrowDown"){if(e.selected===void 0){e.selected=0;return}return e.selected=d(e.selected+1,n.length),!1}if(s.key==="ArrowUp")return e.selected===void 0&&(e.selected=0),e.selected=d(e.selected-1,n.length),!1;if(s.key==="Enter")return e.selected!==void 0&&t(n[e.selected]),!1;s.key==="Escape"&&(e.query="")},r=s=>{e.query=s.target.value,e.selected=0};return m("div",{class:"search",style:{position:"relative",display:"flex",flexGrow:"1",padding:"calc(var(--padding)/2)"}},m("div",{style:{width:"95%",padding:"calc(var(--padding)/2)",borderRadius:"0.25rem",border:n.length>0?"1px solid var(--dark)":"none",position:"absolute",background:n.length>0?"white":null}},m("input",{type:"text",placeholder:"Search",value:e.query,onkeydown:i,oninput:r,style:{width:"99%",border:"0",outline:"0",background:"transparent",marginRight:"var(--padding)"}}),n.length>0?m("div",{class:"results",style:{marginTop:"0.25rem",overflowX:"hidden",overflowY:"auto",maxHeight:"400px"}},n.map((s,d)=>m("div",{onclick:()=>t(s),class:e.selected===d?"selected":""},s.getName()))):null))}};var re={view({attrs:{workspace:o}}){return m("div",null,m("h3",{style:{margin:"0"}},"Treehouse is under active development!"),m("hr",null),m("p",null,"This is a preview based on our main branch, it may have bugs. Please report them."),m("p",null,"Data is stored using localstorage, which you can reset with Reset Demo in the",m("svg",{xmlns:"http://www.w3.org/2000/svg",style:{display:"inline",marginLeft:"0.5rem",marginRight:"0.5rem"},width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},m("path",{d:"M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872l-.1-.34zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"})),"menu in the top right."),m("hr",null),m("div",{style:{textAlign:"right"}},m("button",{style:{padding:"0.5rem",margin:"0.25rem",fontSize:"1.25rem"},onclick:()=>{localStorage.setItem("firsttime","1"),o.hideNotice()}},"Got it")))}},se={view({attrs:{workspace:o,finished:e}}){return m("div",null,m("h3",{style:{margin:"0"}},"Login with GitHub"),m("hr",null),m("p",null,"The GitHub backend is experimental so use at your own risk!"),m("p",null,"To store your workspace we will create a public repository called ",m("pre",{style:{display:"inline"}},"<username>.treehouse.sh")," if it doesn't already exist. You can manually make this repository private via GitHub if you want."),m("p",null,"You can Logout via the",m("svg",{xmlns:"http://www.w3.org/2000/svg",style:{display:"inline",marginLeft:"0.5rem",marginRight:"0.5rem"},width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},m("path",{d:"M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872l-.1-.34zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"})),"menu in the top right to return to the localstorage backend."),m("hr",null),m("div",{style:{textAlign:"right"}},m("button",{style:{padding:"0.5rem",margin:"0.25rem",fontSize:"1.25rem"},onclick:()=>{o.hideNotice(),localStorage.setItem("github","1"),e()}},"Login with GitHub"),m("button",{style:{padding:"0.5rem",margin:"0.25rem",fontSize:"1.25rem"},onclick:()=>{o.hideNotice()}},"Cancel")))}},K={view({attrs:{workspace:o,message:e,finished:n}}){return m("div",{style:{position:"absolute",left:"0",right:"0",top:"0",bottom:"0"}},m("div",{onclick:()=>o.hideNotice(),style:{position:"absolute",background:"black",opacity:"50%",width:"100%",height:"100%"}}),m("div",{style:{position:"relative",marginLeft:"auto",marginRight:"auto",fontSize:"1.25rem",width:"680px",borderRadius:"0.5rem",filter:"drop-shadow(2px 2px 4px #5555)",marginTop:"20vh",padding:"2rem",background:"white"}},m({firsttime:re,github:se}[e],{workspace:o,finished:n})))}};var _={view({attrs:{workspace:o},state:e}){e.open=e.open===void 0?!0:e.open;let n=t=>{e.open?e.open=!1:e.open=!0};return m("main",{style:{margin:"0",display:"flex",flexDirection:"column",position:"absolute",top:"0",bottom:"0",left:"0",right:"0"}},m("div",{style:{display:"flex",borderBottom:"1px solid var(--dark)"}},e.open&&m("div",{style:{width:"200px",display:"flex",padding:"var(--padding)"}},m("div",{style:{flexGrow:"1"}},m("img",{src:"/icon_transparent.png",style:{opacity:"70%",width:"16px",height:"16px"}})),m("svg",{onclick:n,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-layout-sidebar",viewBox:"0 0 16 16"},m("path",{d:"M0 3a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3zm5-1v12h9a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1H5zM4 2H2a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h2V2z"}))),m("div",{style:{flexGrow:"1",display:"flex"}},!e.open&&m("svg",{onclick:n,style:{padding:"var(--padding)",borderLeft:"1px solid var(--dark)"},xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-layout-sidebar",viewBox:"0 0 16 16"},m("path",{d:"M0 3a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3zm5-1v12h9a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1H5zM4 2H2a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h2V2z"})),m("div",{style:{borderLeft:"1px solid var(--dark)"}}),m("div",{onclick:()=>o.openToday(),style:{cursor:"pointer",padding:"var(--padding)",display:"flex",alignItems:"center"}},m("svg",{style:{marginRight:"0.25rem",height:"1rem",width:"1rem"},xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 16 16"},m("path",{d:"M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM2 2a1 1 0 0 0-1 1v11a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1H2z"}),m("path",{d:"M2.5 4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5H3a.5.5 0 0 1-.5-.5V4z"}),m("text",{"text-anchor":"middle",x:"8",y:"13",style:{fontSize:"0.55rem"}},new Date().getDate())),m("div",null,"Today")),m("div",{style:{borderLeft:"1px solid var(--dark)"}}),m("div",{onclick:()=>o.openQuickAdd(),style:{cursor:"pointer",padding:"var(--padding)",display:"flex",alignItems:"center"}},m("svg",{style:{marginRight:"0.25rem",height:"1rem",width:"1rem"},xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 16 16"},m("path",{d:"M11.251.068a.5.5 0 0 1 .227.58L9.677 6.5H13a.5.5 0 0 1 .364.843l-8 8.5a.5.5 0 0 1-.842-.49L6.323 9.5H3a.5.5 0 0 1-.364-.843l8-8.5a.5.5 0 0 1 .615-.09zM4.157 8.5H7a.5.5 0 0 1 .478.647L6.11 13.59l5.732-6.09H9a.5.5 0 0 1-.478-.647L9.89 2.41 4.157 8.5z"})),m("div",null,"Quick Add")),m("div",{style:{borderLeft:"1px solid var(--dark)"}}),m(Y,{workspace:o}),m("div",{style:{borderLeft:"1px solid var(--dark)"}}),m("div",{style:{padding:"var(--padding)"}},m("svg",{onclick:t=>o.showMenu(t),"data-menu":"settings","data-align":"right",style:{cursor:"pointer"},xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},m("path",{d:"M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872l-.1-.34zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"}))))),m("div",{style:{display:"flex",flexGrow:"1"}},e.open&&m("div",{style:{width:"200px",padding:"var(--padding)"}},o.nodes.getRoot().getChildren().map(t=>m(Z,{node:t,expanded:!0,workspace:o}))),m("div",{style:{flexGrow:"1",borderLeft:"1px solid var(--dark)"}},o.panels.map(t=>m("div",{style:{display:"flex"}},t.map(i=>m(W,{workspace:o,panel:i})))))),o.menu&&m(j,{workspace:o,...o.menu}),o.palette&&m(q,{workspace:o,...o.palette}),o.quickadd&&m(Q,{workspace:o}),o.notice&&m(K,{workspace:o,...o.notice}))}},Z={view({attrs:{node:o,workspace:e,expanded:n},state:t}){t.expanded=t.expanded===void 0?n:t.expanded;let i=s=>{t.expanded?t.expanded=!1:t.expanded=!0,s.stopPropagation()},r=s=>{e.open(o)};return m("div",null,m("div",{style:{display:"flex"}},m("svg",{onclick:i,style:{cursor:"pointer",flexShrink:"0",width:"1rem",height:"1rem",marginRight:"0.25rem",paddingLeft:"1px"},xmlns:"http://www.w3.org/2000/svg",fill:"gray",viewBox:"0 0 16 16"},o.childCount()>0?t.expanded?m("path",{d:"M3.204 5h9.592L8 10.481 3.204 5zm-.753.659 4.796 5.48a1 1 0 0 0 1.506 0l4.796-5.48c.566-.647.106-1.659-.753-1.659H3.204a1 1 0 0 0-.753 1.659z"}):m("path",{d:"M6 12.796V3.204L11.481 8 6 12.796zm.659.753 5.48-4.796a1 1 0 0 0 0-1.506L6.66 2.451C6.011 1.885 5 2.345 5 3.204v9.592a1 1 0 0 0 1.659.753z"}):null),m("div",{onclick:r,style:{cursor:"pointer",flexGrow:"1",display:"flex"}},o.getName())),t.expanded&&m("div",{style:{paddingBottom:"0.25rem",marginLeft:"0.5rem"}},o.getChildren().filter(s=>s.getName()!=="").map(s=>m(Z,{workspace:e,node:s}))))}};var b=class{constructor(){this.auth=null,this.files=new E,this.nodes=new z(this.files),window.MiniSearch?this.index=new L:this.index=new R}},L=class{constructor(){this.indexer=new MiniSearch({idField:"ID",fields:["ID","Name","Value.markdown"],storeFields:["ID"],extractField:(e,n)=>n.split(".").reduce((t,i)=>t&&t[i],e)})}index(e){this.indexer.has(e.ID)?this.indexer.replace(e):this.indexer.add(e)}remove(e){this.indexer.discard(e)}search(e){let n=this.indexer.autoSuggest(e);return n.length===0?[]:this.indexer.search(n[0].suggestion).map(t=>t.ID)}},R=class{constructor(){this.nodes={}}index(e){this.nodes[e.ID]=e.Name}remove(e){delete this.nodes[e]}search(e){let n=[];for(let t in this.nodes)this.nodes[t].includes(e)&&n.push(t);return n}},z=class{constructor(e){this.files=e}async loadAll(){return JSON.parse(await this.files.readFile("workspace.json")||"[]")}async saveAll(e){await this.files.writeFile("workspace.json",JSON.stringify(e))}},E=class{async readFile(e){return localStorage.getItem(`treehouse:${e}`)}async writeFile(e,n){localStorage.setItem(`treehouse:${e}`,n)}};var H=class{constructor(e,n){this.loginURL=e,this.clientFactory=n,this.auth=this,this.shas={};let t=new b;this.index=t.index,this.nodes=t.nodes,this.files=t.files,this.writeDebounce=ae((i,r)=>{console.log("Saving workspace..."),this.writeFile(i,r)})}get repo(){return`${this.user?.userID()}.treehouse.sh`}async initialize(){let e=new URL(location.href).searchParams.get("code");if(e)try{let n=location.search.replace(/\bcode=\w+/,"").replace(/\?$/,"");history.pushState({},"",`${location.pathname}${n}`);let i=await(await fetch(this.loginURL,{method:"POST",mode:"cors",headers:{"content-type":"application/json"},body:JSON.stringify({code:e})})).json();if(i.error)throw i.error;localStorage.setItem("treehouse:gh-token",i.token)}catch(n){this.reset(),console.error(n);return}if(await this.authenticate(),!this.user){console.error("authentication failed");return}try{await this.client.rest.repos.get({owner:this.user.userID(),repo:this.repo})}catch(n){if(n.message!=="Not Found")throw n;console.log("Creating repository...");let t=await this.client.rest.repos.createForAuthenticatedUser({name:this.repo});if(t.status!==201){console.error(t);return}}try{await this.client.rest.repos.getContent({owner:this.user.userID(),repo:this.repo,path:"workspace.json"})}catch(n){if(n.name!=="HttpError")throw n;console.log("Creating workspace.json...");let t=await this.client.rest.repos.createOrUpdateFileContents({owner:this.user.userID(),repo:this.repo,path:"workspace.json",message:"initial commit",content:btoa(JSON.stringify([]))});if(t.status!==201){console.error(t);return}}this.files=this,this.nodes=this}async authenticate(){let e=localStorage.getItem("treehouse:gh-token");if(!e)return;this.client=new this.clientFactory({auth:e});let n=await this.client.rest.users.getAuthenticated();!n||n.error||(this.user=new T(n.data),m&&m.redraw())}currentUser(){return this.user}login(){location.assign(this.loginURL)}reset(){localStorage.removeItem("treehouse:gh-token"),this.user=null,m&&m.redraw()}logout(){this.reset(),location.reload()}async loadAll(){return JSON.parse(await this.readFile("workspace.json")||"[]")}async saveAll(e){this.writeDebounce("workspace.json",JSON.stringify(e,null,2))}async readFile(e){try{let n=await this.client.rest.repos.getContent({owner:this.user?.userID(),repo:this.repo,path:e,random:Math.random().toString(36).substring(2)});return this.shas[e]=n.data.sha,atob(n.data.content)}catch(n){return n.name!=="HttpError"&&console.error(n),null}}async writeFile(e,n){let t=await this.client.rest.repos.createOrUpdateFileContents({owner:this.user?.userID(),repo:this.repo,path:e,message:"autosave",content:btoa(n),sha:this.shas[e]});this.shas[e]=t.data.content.sha}},T=class{constructor(e){this.user=e}userID(){return this.user.login}displayName(){return this.user.name}avatarURL(){return this.user.avatar_url}};function ae(o,e=3e3){let n;return(...t)=>{clearTimeout(n),n=setTimeout(()=>{o.apply(this,t)},e)}}var p=class{constructor(){this.checked=!1}};p=A([B],p);var f=class{constructor(){this.markdown=""}};f=A([B],f);async function Je(o,e,n){n.initialize&&await n.initialize();let t=new k(n);await t.initialize(),window.workspace=t,t.commands.registerCommand({id:"add-page",title:"Add page",action:i=>{if(!i.node)return;let r=new f;i.node.addComponent(r)}}),t.commands.registerCommand({id:"remove-page",title:"Remove page",action:i=>{i.node&&i.node.removeComponent(f)}}),t.commands.registerCommand({id:"add-checkbox",title:"Add checkbox",action:i=>{if(!i.node)return;let r=new p;i.node.addComponent(r)}}),t.commands.registerCommand({id:"remove-checkbox",title:"Remove checkbox",action:i=>{i.node&&i.node.removeComponent(p)}}),t.commands.registerCommand({id:"mark-done",title:"Mark done",action:i=>{if(i.node)if(i.node.hasComponent(p)){let r=i.node.getComponent(p);r.checked?i.node.removeComponent(p):(r.checked=!0,i.node.changed())}else{let r=new p;i.node.addComponent(r)}}}),t.keybindings.registerBinding({command:"mark-done",key:"meta+enter"}),t.commands.registerCommand({id:"expand",title:"Expand",action:i=>{i.node&&(t.setExpanded(i.node,!0),m.redraw())}}),t.keybindings.registerBinding({command:"expand",key:"meta+arrowdown"}),t.commands.registerCommand({id:"collapse",title:"Collapse",action:i=>{i.node&&(t.setExpanded(i.node,!1),m.redraw())}}),t.keybindings.registerBinding({command:"collapse",key:"meta+arrowup"}),t.commands.registerCommand({id:"indent",title:"Indent",action:i=>{if(!i.node)return;let r=g(i.node.getPrevSibling(),i.node.panel);if(r!==null){i.node.setParent(r),t.setExpanded(r,!0);let s=i.node;m.redraw.sync(),t.focus(s)}}}),t.keybindings.registerBinding({command:"indent",key:"tab"}),t.commands.registerCommand({id:"outdent",title:"Outdent",action:i=>{if(!i.node)return;let r=g(i.node.getParent(),i.node.panel);if(r!==null&&r.ID!=="@root"){i.node.setParent(r.getParent()),i.node.setSiblingIndex(r.getSiblingIndex()+1),r.childCount()===0&&t.setExpanded(r,!1);let s=i.node;m.redraw.sync(),t.focus(s)}}}),t.keybindings.registerBinding({command:"outdent",key:"shift+tab"}),t.commands.registerCommand({id:"insert-child",title:"Insert Child",action:(i,r="")=>{if(!i.node)return;let s=t.nodes.new(r);s.setParent(i.node),t.setExpanded(i.node,!0),m.redraw.sync(),t.focus(g(s,i.node.panel),r.length)}}),t.commands.registerCommand({id:"insert-before",title:"Insert Before",action:i=>{if(!i.node)return;let r=t.nodes.new("");r.setParent(i.node.getParent()),r.setSiblingIndex(i.node.getSiblingIndex()),m.redraw.sync(),t.focus(g(r,i.node.panel))}}),t.commands.registerCommand({id:"insert",title:"Insert Node",action:(i,r="")=>{if(!i.node)return;let s=t.nodes.new(r);s.setParent(i.node.getParent()),s.setSiblingIndex(i.node.getSiblingIndex()+1),m.redraw.sync(),t.focus(g(s,i.node.panel))}}),t.keybindings.registerBinding({command:"insert",key:"shift+enter"}),t.commands.registerCommand({id:"delete",title:"Delete node",action:i=>{if(!i.node)return;let r=i.node.getPrevSibling();if(i.node.destroy(),m.redraw.sync(),r){let s=0;i.event&&i.event.key==="Backspace"&&(s=r.getName().length),t.focus(g(r,i.node.panel),s)}}}),t.keybindings.registerBinding({command:"delete",key:"shift+meta+backspace"}),t.commands.registerCommand({id:"prev",action:i=>{if(!i.node)return;let r=i.node.getPrevSibling();r!==null?t.focus(g(r,i.node.panel)):t.focus(g(i.node.getParent(),i.node.panel))}}),t.keybindings.registerBinding({command:"prev",key:"arrowup"}),t.commands.registerCommand({id:"next",action:i=>{if(!i.node)return;let r=i.node.getNextSibling();if(r!==null)t.focus(g(r,i.node.panel));else return}}),t.keybindings.registerBinding({command:"next",key:"arrowdown"}),t.commands.registerCommand({id:"pick-command",action:i=>{if(!i.node)return;let r=t.getInput(i.node),s=r.getBoundingClientRect(),d=o.body.scrollLeft+s.x+r.selectionStart*10+20,l=o.body.scrollTop+s.y-8;t.showPalette(d,l,t.newContext({node:i.node}))}}),t.keybindings.registerBinding({command:"pick-command",key:"meta+k"}),t.commands.registerCommand({id:"new-panel",title:"Open in New Panel",action:i=>{i.node&&(t.openNewPanel(i.node),m.redraw())}}),t.commands.registerCommand({id:"close-panel",title:"Close Panel",action:(i,r)=>{t.closePanel(r||i.node.panel),m.redraw()}}),t.commands.registerCommand({id:"zoom",title:"Open",action:i=>{i.node.panel.history.push(i.node),m.redraw()}}),t.commands.registerCommand({id:"generate-random",title:"Generate Random Children",action:i=>{i.node&&[...Array(100)].forEach(()=>{t.nodes.new(de(8)).setParent(i.node)})}}),t.menus.registerMenu("node",[{command:"zoom"},{command:"new-panel"},{command:"indent"},{command:"outdent"},{command:"delete"},{command:"add-checkbox"},{command:"remove-checkbox"},{command:"mark-done"},{command:"add-page"},{command:"remove-page"},{command:"generate-random"}]),t.menus.registerMenu("settings",[{title:()=>`${t.backend.auth?.currentUser()?.userID()} @ GitHub`,disabled:!0,when:()=>t.authenticated()},{title:()=>"Login with GitHub",when:()=>!t.authenticated(),onclick:()=>{localStorage.getItem("github")?t.backend.auth.login():t.showNotice("github",()=>{t.backend.auth.login()})}},{title:()=>"Reset Demo",when:()=>!t.authenticated(),onclick:()=>{localStorage.clear(),location.reload()}},{title:()=>"Submit Issue",onclick:()=>window.open("https://github.com/treehousedev/treehouse/issues","_blank")},{title:()=>"Logout",when:()=>t.authenticated(),onclick:()=>t.backend.auth.logout()}]),o.addEventListener("keydown",i=>{let r=t.keybindings.evaluateEvent(i);r&&t.context.node&&(t.commands.executeCommand(r.command,t.context),i.stopPropagation(),i.preventDefault())}),o.addEventListener("click",i=>{t.hideMenu()}),m.mount(e,{view:()=>m(_,{workspace:t})})}function de(o=10){let e=(i,r)=>Math.round(Math.random()*(r-i)+i),n=()=>{let i=["got","ability","shop","recall","fruit","easy","dirty","giant","shaking","ground","weather","lesson","almost","square","forward","bend","cold","broken","distant","adjective"];return i[e(0,i.length-1)]};return(i=>[...Array(i)].map((r,s)=>n()).join(" ").trim())(e(2,o))}export{b as BrowserBackend,p as Checkbox,H as GitHubBackend,f as Page,L as SearchIndex_MiniSearch,Je as setup};
