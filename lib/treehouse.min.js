var I=navigator.userAgent.toLowerCase().indexOf("mac")!==-1;function S(i){if(!i)return[];let e={backspace:"\u232B",shift:"\u21E7",meta:"\u2318",tab:"\u21B9",ctrl:"\u2303",uparrow:"\u2191",downarrow:"\u2193",leftarrow:"\u2190",rightarrow:"\u2192",enter:"\u23CE"};return i.toLowerCase().split("+").map(D).map(n=>Object.keys(e).includes(n)?e[n]:n)}function D(i){return!I&&i==="meta"?"ctrl":i}var x=class{constructor(){this.bindings=[]}registerBinding(e){this.bindings.push(e)}getBinding(e){for(let t of this.bindings)if(t.command===e)return t;return null}evaluateEvent(e){e:for(let t of this.bindings){let n=t.key.toLowerCase().split("+");if(n.pop()===e.key.toLowerCase()){for(let r of["shift","ctrl","alt","meta"]){let s=n.includes(r);if(!I){if(r==="meta")continue;r==="ctrl"&&(s=n.includes("meta")||n.includes("ctrl"))}let a=e[`${D(r)}Key`];if(!a&&s||a&&!s)continue e}return t}}return null}};var y=class{constructor(){this.commands={}}registerCommand(e){this.commands[e.id]=e}executeCommand(e,...t){return this.commands[e].action(...t)}};function h(i){return i.constructor&&i.constructor.__module&&(i=i.constructor),i.__module?`${i.__module}.${i.name}`:i.name}var p=class{constructor(e,t){this.module=e,this.ID=t}changed(){this.module.changed(this)}get isDestroyed(){return!this.module.nodes.hasOwnProperty(this.ID)}get raw(){return this.module.nodes[this.ID]}getName(){return this.raw.Name}setName(e){this.raw.Name=e,this.changed()}getValue(){return this.raw.Value}getParent(){return this.raw.Parent?new p(this.module,this.raw.Parent):null}setParent(e){let t=this.getParent();t!==null&&t.raw.Linked.Children.splice(this.getSiblingIndex(),1),this.raw.Parent=e.ID,e.raw.Linked.Children.push(this.ID),this.changed()}getChildren(){return this.raw.Linked.Children?this.raw.Linked.Children.map(e=>new p(this.module,e)):[]}getAttr(e){return this.raw.Attrs[e]||""}setAttr(e,t){this.raw.Attrs[e]=t,this.changed()}getSiblingIndex(){let e=this.getParent();return e===null?0:e.raw.Linked.Children.findIndex(t=>t===this.ID)}setSiblingIndex(e){let t=this.getParent();t!==null&&(t.raw.Linked.Children.splice(this.getSiblingIndex(),1),t.raw.Linked.Children.splice(e,0,this.ID),t.changed())}getPrevSibling(){let e=this.getParent();return e===null||this.getSiblingIndex()===0?null:e.getChildren()[this.getSiblingIndex()-1]}getNextSibling(){let e=this.getParent();return e===null||this.getSiblingIndex()===e.getChildren().length-1?null:e.getChildren()[this.getSiblingIndex()+1]}destroy(){this.module.destroy(this)}addComponent(e){let t=this.module.new(h(e),e);t.raw.Parent=this.ID,this.raw.Linked.Components.push(t.ID),this.changed()}removeComponent(e){let t=this.getComponentNodes().filter(n=>n.getName()===h(e));t.length>0&&t[0].destroy()}hasComponent(e){return this.getComponentNodes().filter(n=>n.getName()===h(e)).length>0}getComponent(e){let t=this.getComponentNodes().filter(n=>n.getName()===h(e));return t.length>0?t[0].getValue():null}getComponentNodes(){return this.raw.Linked.Components?this.raw.Linked.Components.map(e=>new p(this.module,e)):[]}},b=class{constructor(){this.nodes={"@root":{ID:"@root",Name:"@root",Linked:{Children:[],Components:[]},Attrs:{}}},this.observers=[]}import(e){for(let t of e)this.nodes[t.ID]=t}export(){let e=[];for(let t of Object.values(this.nodes))e.push(t);return e}new(e,t){let n=e.startsWith("@")?e:M();return this.nodes[n]={ID:n,Name:e,Value:t,Linked:{Children:[],Components:[]},Attrs:{}},new p(this,n)}destroy(e){let t=e.getParent();t!==null&&(t.raw.Linked.Children.includes(e.ID)&&t.raw.Linked.Children.splice(e.getSiblingIndex(),1),t.raw.Linked.Components.includes(e.ID)&&t.raw.Linked.Components.splice(e.getSiblingIndex(),1)),delete this.nodes[e.ID]}roots(){return Object.values(this.nodes).filter(e=>e.Parent===void 0).map(e=>new p(this,e.ID))}changed(e){this.observers.forEach(t=>t(e))}find(e){for(let t of Object.values(this.nodes))if(t.Name===e)return new p(this,t.ID);return null}},M=()=>{let i=Date.now().toString(36),e=Math.random().toString(36).substring(2);return i+e};function Z(i){return{ID:M(),Name:i,Linked:{Children:[],Components:[]},Attrs:{}}}function _(i){let e=[];for(let t=0;t<i;t++)e.push(Z(q(f(2,6))));return e}function L(i){let e={},t=_(i);t.forEach(n=>{e[n.ID]=n,f(0,4)>0&&(n.Parent=t[f(0,i-1)].ID)});for(let[n,o]of Object.entries(e))o.Parent===o.ID&&(o.Parent=void 0),o.Parent&&e[o.Parent].Linked.Children.push(o.ID);return e}var B=["Got","ability","shop","recall","fruit","easy","dirty","giant","shaking","ground","weather","lesson","almost","square","forward","bend","cold","broken","distant","adjective"];function K(i=!1){let e=B[f(0,B.length-1)];return i?e.charAt(0).toUpperCase()+e.slice(1):e}function q(i=10){return[...Array(i)].map((e,t)=>K(t===0)).join(" ").trim()}function f(i,e){return Math.round(Math.random()*(e-i)+i)}var C=class{constructor(){this.menus={}}registerMenu(e,t){this.menus[e]=t}};var k=class{constructor(e){e.panel=this,this.id=Math.random().toString(36).substring(2),this.history=[e]}};function c(i,e){return i.panel=e,i}var v=class{constructor(e){this.commands=new y,this.keybindings=new x,this.menus=new C,this.backend=e,this.nodes=new b;let t=this.backend.loadAll(),n=this.nodes.find("@root");if(t.length===0){let o=this.nodes.new("Workspace");o.setParent(n),this.nodes.new("Calendar").setParent(o),this.nodes.new("Home").setParent(o);let a=this.nodes.new("Random");a.setParent(o);for(let l of Object.values(L(1e3)))l.Parent===void 0&&(l.Parent=a.ID,a.raw.Linked.Children.push(l.ID)),t.push(l)}this.nodes.import(t),this.nodes.observers.push(o=>{this.backend.saveAll(Object.values(this.nodes.nodes))}),this.context={node:null},this.panels=[[]],this.expanded={},this.openNewPanel(n?.getChildren()[0])}open(e){this.expanded[e.ID]||(this.expanded[e.ID]={}),this.panels[0][0]=new k(e)}openNewPanel(e){this.expanded[e.ID]={};let t=new k(e);this.panels[0].push(t)}closePanel(e){this.panels.forEach((t,n)=>{this.panels[n]=t.filter(o=>o!==e)})}focus(e,t=0){this.context.node=e,e&&(document.getElementById(`input-${e.panel.id}-${e.ID}`)?.focus(),document.getElementById(`input-${e.panel.id}-${e.ID}`)?.setSelectionRange(t,t))}getInput(e){return document.getElementById(`input-${e.panel.id}-${e.ID}`)}executeCommand(e,t,...n){return this.commands.executeCommand(e,this.newContext(t),...n)}newContext(e){return Object.assign({},this.context,e)}showMenu(e,t,n,o){let r=this.menus.menus[e];!r||(this.menu={x:t,y:n,ctx:this.newContext(o),items:r.map(s=>Object.assign(this.commands.commands[s.command],this.keybindings.getBinding(s.command)))},m.redraw())}hideMenu(){this.menu=null,m.redraw()}showPalette(e,t,n){this.palette={x:e,y:t,ctx:n},m.redraw()}hidePalette(){this.palette=null,m.redraw()}getExpanded(e){let t=this.expanded[e.panel.history[0].ID][e.ID];return t===void 0&&(t=!1),t}setExpanded(e,t){this.expanded[e.panel.history[0].ID][e.ID]=t}};var A={view({attrs:i}){let e=i.workspace,t={margin:"0px",listStyleType:"none",padding:"0.25rem 0.5rem 0.25rem 0.5rem",display:"flex"},n={flexGrow:"1",textAlign:"right",color:"#888",marginLeft:"1rem"},o=r=>s=>{e.executeCommand(r.id,i.ctx),e.hideMenu(),s.stopPropagation()};return m("ul",{class:"menu",style:{margin:"0",position:"absolute",left:`${i.x}px`,top:`${i.y}px`,border:"1px solid var(--dark)",borderRadius:"0.25rem",padding:"0.25rem 0 0.25rem 0",display:"inline-block",background:"white",filter:"drop-shadow(2px 2px 4px #5555)",fontSize:"14px",minWidth:"200px"}},i.items.map(r=>m("li",{onclick:o(r),style:t},m("div",null,r.title),m("div",{style:n},S(r.key).join("+")))))}};var R={onupdate({state:i,dom:e}){let t=e.querySelector(".commands").children;i.selected!==void 0&&t.length>0&&t[i.selected].scrollIntoView({block:"nearest"})},oncreate({dom:i}){i.querySelector("input").focus()},view({attrs:i,state:e}){let t=i.workspace;e.filter=e.filter===void 0?"":e.filter;let o=Object.values(t.commands.commands).filter(a=>a.id.startsWith(e.filter)),r=a=>{let l=(g,u)=>(g%u+u)%u;if(a.key==="ArrowDown"){if(e.selected===void 0){e.selected=0;return}return e.selected=l(e.selected+1,o.length),!1}if(a.key==="ArrowUp")return e.selected===void 0&&(e.selected=0),e.selected=l(e.selected-1,o.length),!1;if(a.key==="Enter")return e.selected!==void 0&&(t.commands.executeCommand(o[e.selected].id,i.ctx),t.hidePalette()),!1;a.key==="Escape"&&t.hidePalette()},s=a=>{e.filter=a.target.value,e.selected=0};return m("div",{class:"palette",style:{margin:"0",position:"absolute",left:`${i.x}px`,top:`${i.y}px`,border:"1px solid #555",borderRadius:"0.25rem",padding:"0 0 0.25rem 0",background:"white",fontSize:"14px",minWidth:"200px"}},m("div",null,m("input",{style:{width:"100%"},type:"text",onkeydown:r,oninput:s,placeholder:"Enter command..."})),m("div",{class:"commands",style:{overflowY:"scroll",maxHeight:"100px",position:"relative"}},o.map((a,l)=>m("div",{class:e.selected===l?"selected":""},a.id))))}};var N={view({attrs:i,state:e,children:t}){let{node:n,workspace:o}=i,r=o.getExpanded(n),s=d=>{e.hover=!0,d.stopPropagation()},a=d=>{e.hover=!1,d.stopPropagation()},l=d=>{r?o.executeCommand("collapse",{node:n}):o.executeCommand("expand",{node:n}),d.stopPropagation()},g=d=>{o.context.node=n,e.editing=!0,e.buffer=n.getName()},u=d=>{e.editing=!1,n.isDestroyed||n.setName(e.buffer),e.buffer=void 0,o.context.node=null},H=d=>{e.buffer=d.target.value},T=d=>{o.executeCommand("insert-child",{node:n},d.target.value),d.stopPropagation()},G=d=>{let P=d.target.closest("*[data-menu]"),w=P.getBoundingClientRect(),j=document.body.scrollLeft+w.x,W=document.body.scrollTop+w.y+w.height;o.showMenu(P.dataset.menu,j,W,{node:n}),d.preventDefault()},$=d=>{switch(d.key){case"Backspace":if(d.target.value===""){o.executeCommand("delete",{node:n}),d.stopPropagation();return}if(d.target.value!==""&&d.target.selectionStart===0){console.log("TODO!"),d.stopPropagation();return}break;case"Enter":if(d.target.selectionStart===d.target.value.length){o.executeCommand("insert",{node:n}),d.stopPropagation();return}if(d.target.selectionStart===0){o.executeCommand("insert-before",{node:n}),d.stopPropagation();return}if(d.target.selectionStart>0&&d.target.selectionStart<d.target.value.length){e.buffer=d.target.value.slice(0,d.target.selectionStart),o.executeCommand("insert",{node:n},d.target.value.slice(d.target.selectionStart)),d.stopPropagation();return}break}};return m("div",{style:{paddingLeft:"1rem"},onmouseover:s,onmouseout:a},m("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",marginTop:"0.125rem",marginBottom:"0.125rem"}},m("svg",{xmlns:"http://www.w3.org/2000/svg",style:{flexShrink:"0",width:"1rem",height:"1rem",position:"absolute",marginLeft:"-1rem",userSelect:"none",display:e.hover?"block":"none"},onclick:l,fill:"gray",viewBox:"0 0 16 16"},m("circle",{cx:"8",cy:"7",r:"7",fill:"lightgray"}),!r&&m("path",{style:{transform:"scale(0.6) translate(5px, 3px)"},d:"m12.14 8.753-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z"}),r&&m("path",{style:{transform:"scale(0.6) translate(5px, 4px)"},d:"M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"})),m("svg",{oncontextmenu:G,"data-menu":"node",style:{flexShrink:"0",width:"1rem",height:"1rem",marginRight:"0.5rem",paddingLeft:"1px"},xmlns:"http://www.w3.org/2000/svg",fill:"gray",viewBox:"0 0 16 16"},n.getChildren().length>0?m("circle",{cx:"8",cy:"7",r:"7",fill:"lightgray"}):null,m("circle",{cx:"8",cy:"7",r:"3"})),m("div",{style:{flexGrow:"1",display:"flex"}},m("input",{id:`input-${n.panel.id}-${n.ID}`,type:"text",value:e.editing?e.buffer:n.getName(),onfocus:g,onblur:u,oninput:H,onkeydown:$,style:{border:"0px",flexGrow:"1",outline:"0px"}}))),m("div",{style:{display:r?"flex":"none",flexDirection:"row",paddingBottom:"0.25rem"}},m("div",{style:{width:"1rem",marginRight:"0.25rem",display:"flex"},onclick:l},m("div",{style:{borderLeft:"1px solid gray",height:"100%",marginLeft:"0.5rem"}})),m("div",{style:{flexGrow:"1"}},n.getChildren().length>0?n.getChildren().map(d=>m(N,{key:d.ID,workspace:o,node:c(d,n.panel)})):m("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",paddingLeft:"1rem",marginTop:"0.125rem",marginBottom:"0.125rem"}},m("svg",{style:{flexShrink:"0",width:"1rem",height:"1rem",marginRight:"0.5rem",paddingLeft:"1px"},xmlns:"http://www.w3.org/2000/svg",fill:"gray",viewBox:"0 0 16 16"},m("circle",{cx:"8",cy:"7",r:"7",fill:"lightgray"}),m("path",{fill:"#555",style:{transform:"translate(0px, -1px)"},d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"})),m("div",{style:{flexGrow:"1",display:"flex"}},m("input",{type:"text",oninput:T,style:{border:"0px",flexGrow:"1",outline:"0px"}}))))))}};var E={view({attrs:i}){let e=i.panel,t=i.workspace,n=e.history[e.history.length-1],o=g=>{t.executeCommand("close-panel",{},e)},r=g=>{e.history.pop()},s=g=>{t.panels=[[e]]},a=g=>{t.closePanel(e),t.panels.push([e])},l=g=>{t.closePanel(e),t.panels.unshift([e])};return m("div",{style:{flexGrow:"1",margin:"var(--padding)",background:"white",borderRadius:"0.5rem",paddingBottom:"var(--padding)",height:"92vh"}},m("div",{style:{display:"flex",color:"gray",padding:"var(--padding)",gap:"var(--padding)",borderBottom:"4px solid var(--background)"}},e.history.length>1?m("div",{style:{rightPadding:"var(--padding)"}},m("svg",{onclick:r,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},m("path",{"fill-rule":"evenodd",d:"M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"}))):null,m("div",{style:{flexGrow:"1"}},n.getParent()?.getName()),t.panels.flat().length>1?m("div",{style:{display:"flex",gap:"0.5rem"}},m("svg",{onclick:a,style:{transform:"scaleY(-1)"},xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},m("path",{d:"M2.375 1A2.366 2.366 0 0 0 0 3.357v9.286A2.366 2.366 0 0 0 2.375 15h11.25A2.366 2.366 0 0 0 16 12.643V3.357A2.366 2.366 0 0 0 13.625 1H2.375ZM1 3.357C1 2.612 1.611 2 2.375 2h11.25C14.389 2 15 2.612 15 3.357V4H1v-.643ZM1 5h14v7.643c0 .745-.611 1.357-1.375 1.357H2.375A1.366 1.366 0 0 1 1 12.643V5Z"})),m("svg",{onclick:l,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},m("path",{d:"M2.375 1A2.366 2.366 0 0 0 0 3.357v9.286A2.366 2.366 0 0 0 2.375 15h11.25A2.366 2.366 0 0 0 16 12.643V3.357A2.366 2.366 0 0 0 13.625 1H2.375ZM1 3.357C1 2.612 1.611 2 2.375 2h11.25C14.389 2 15 2.612 15 3.357V4H1v-.643ZM1 5h14v7.643c0 .745-.611 1.357-1.375 1.357H2.375A1.366 1.366 0 0 1 1 12.643V5Z"})),m("svg",{onclick:s,style:{transform:"scale(0.9)"},xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},m("path",{d:"M1.5 1a.5.5 0 0 0-.5.5v4a.5.5 0 0 1-1 0v-4A1.5 1.5 0 0 1 1.5 0h4a.5.5 0 0 1 0 1h-4zM10 .5a.5.5 0 0 1 .5-.5h4A1.5 1.5 0 0 1 16 1.5v4a.5.5 0 0 1-1 0v-4a.5.5 0 0 0-.5-.5h-4a.5.5 0 0 1-.5-.5zM.5 10a.5.5 0 0 1 .5.5v4a.5.5 0 0 0 .5.5h4a.5.5 0 0 1 0 1h-4A1.5 1.5 0 0 1 0 14.5v-4a.5.5 0 0 1 .5-.5zm15 0a.5.5 0 0 1 .5.5v4a1.5 1.5 0 0 1-1.5 1.5h-4a.5.5 0 0 1 0-1h4a.5.5 0 0 0 .5-.5v-4a.5.5 0 0 1 .5-.5z"})),m("svg",{onclick:o,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},m("path",{d:"M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"}))):null),m("div",{style:{padding:"var(--padding)"}},n.getName()),m("div",{style:{padding:"var(--padding)"}},n.getChildren().map(g=>m(N,{key:g.ID,workspace:t,node:c(g,n.panel)}))))}};var O={view({attrs:{workspace:i},state:e}){e.open=e.open===void 0?!0:e.open;let t=o=>{localStorage.clear(),location.reload()},n=o=>{e.open?e.open=!1:e.open=!0};return m("main",{style:{margin:"0",display:"flex",flexDirection:"column",position:"absolute",top:"0",bottom:"0",left:"0",right:"0"}},m("div",{style:{display:"flex",borderBottom:"1px solid var(--dark)"}},e.open&&m("div",{style:{width:"200px",display:"flex",padding:"var(--padding)"}},m("div",{style:{flexGrow:"1"}},m("img",{src:"/icon_transparent.png",style:{opacity:"70%",width:"16px",height:"16px"}})),m("svg",{onclick:n,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-layout-sidebar",viewBox:"0 0 16 16"},m("path",{d:"M0 3a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3zm5-1v12h9a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1H5zM4 2H2a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h2V2z"}))),m("div",{style:{flexGrow:"1",display:"flex"}},!e.open&&m("svg",{onclick:n,style:{padding:"var(--padding)",borderLeft:"1px solid var(--dark)"},xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-layout-sidebar",viewBox:"0 0 16 16"},m("path",{d:"M0 3a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3zm5-1v12h9a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1H5zM4 2H2a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h2V2z"})),m("div",{style:{borderLeft:"1px solid var(--dark)"}}),m("div",{style:{padding:"var(--padding)"}},"Today"),m("div",{style:{borderLeft:"1px solid var(--dark)"}}),m("div",{style:{padding:"var(--padding)"}},"Quick Add"),m("div",{style:{borderLeft:"1px solid var(--dark)"}}),m("div",{style:{flexGrow:"1",padding:"var(--padding)"}},m("input",{type:"text",placeholder:"Search",style:{width:"99%",border:"0",outline:"0",background:"transparent",marginRight:"var(--padding)"}})),m("div",{style:{borderLeft:"1px solid var(--dark)"}}),m("div",{style:{padding:"var(--padding)"}},m("button",{onclick:t},"Reset")))),m("div",{style:{display:"flex",flexGrow:"1"}},e.open&&m("div",{style:{width:"200px",padding:"var(--padding)"}},i.nodes.roots()[0].getChildren().map(o=>m(z,{node:o,workspace:i}))),m("div",{style:{flexGrow:"1",borderLeft:"1px solid var(--dark)"}},i.panels.map(o=>m("div",{style:{display:"flex"}},o.map(r=>m(E,{workspace:i,panel:r})))))),i.menu&&m(A,{workspace:i,...i.menu}),i.palette&&m(R,{workspace:i,...i.palette}))}},z={view({attrs:{node:i,workspace:e},state:t}){t.expanded=t.expanded===void 0?!1:t.expanded;let n=r=>{t.expanded?t.expanded=!1:t.expanded=!0,r.stopPropagation()},o=r=>{e.open(i)};return m("div",null,m("div",{style:{display:"flex"}},m("svg",{onclick:n,style:{flexShrink:"0",width:"1rem",height:"1rem",marginRight:"0.5rem",paddingLeft:"1px"},xmlns:"http://www.w3.org/2000/svg",fill:"black",viewBox:"0 0 16 16"},t.expanded&&m("path",{d:"M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"}),!t.expanded&&m("path",{d:"m12.14 8.753-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z"})),m("div",{onclick:o,style:{flexGrow:"1",display:"flex"}},i.getName())),t.expanded&&m("div",{style:{paddingBottom:"0.25rem",marginLeft:"0.5rem"}},i.getChildren().map(r=>m(z,{workspace:e,node:r}))))}};var V=class{loadAll(){let e=localStorage.getItem("treehouse-nodes");return e==="undefined"&&(e=void 0),JSON.parse(e||"[]")}saveAll(e){localStorage.setItem("treehouse-nodes",JSON.stringify(e))}save(e){}};function Se(i,e,t){let n=new v(t);n.commands.registerCommand({id:"expand",title:"Expand",action:o=>{!o.node||(n.setExpanded(o.node,!0),m.redraw())}}),n.keybindings.registerBinding({command:"expand",key:"meta+arrowdown"}),n.commands.registerCommand({id:"collapse",title:"Collapse",action:o=>{!o.node||(n.setExpanded(o.node,!1),m.redraw())}}),n.keybindings.registerBinding({command:"collapse",key:"meta+arrowup"}),n.commands.registerCommand({id:"indent",title:"Indent",action:o=>{if(!o.node)return;let r=o.node.getPrevSibling();r!==null&&(o.node.setParent(r),r.setAttr("expanded",JSON.stringify(!0)),m.redraw.sync(),n.focus(o.node))}}),n.keybindings.registerBinding({command:"indent",key:"tab"}),n.commands.registerCommand({id:"outdent",title:"Outdent",action:o=>{if(!o.node)return;let r=o.node.getParent();r!==null&&r.ID!=="@root"&&(o.node.setParent(r.getParent()),o.node.setSiblingIndex(r.getSiblingIndex()+1),m.redraw.sync(),n.focus(o.node))}}),n.keybindings.registerBinding({command:"outdent",key:"shift+tab"}),n.commands.registerCommand({id:"insert-child",title:"Insert Child",action:(o,r="")=>{if(!o.node)return;n.nodes.new(r).setParent(o.node),m.redraw.sync(),n.focus(o.node,r.length)}}),n.commands.registerCommand({id:"insert-before",title:"Insert Before",action:o=>{if(!o.node)return;let r=n.nodes.new("");r.setParent(o.node.getParent()),r.setSiblingIndex(o.node.getSiblingIndex()),m.redraw.sync(),n.focus(c(r,o.node.panel))}}),n.commands.registerCommand({id:"insert",title:"Insert Node",action:(o,r="")=>{if(!o.node)return;let s=n.nodes.new(r);s.setParent(o.node.getParent()),s.setSiblingIndex(o.node.getSiblingIndex()+1),m.redraw.sync(),n.focus(c(s,o.node.panel))}}),n.keybindings.registerBinding({command:"insert",key:"shift+enter"}),n.commands.registerCommand({id:"delete",title:"Delete node",action:o=>{if(!o.node)return;let r=o.node.getPrevSibling();o.node.destroy(),m.redraw.sync(),r&&n.focus(c(r,o.node.panel))}}),n.keybindings.registerBinding({command:"delete",key:"shift+meta+backspace"}),n.commands.registerCommand({id:"prev",action:o=>{if(!o.node)return;let r=o.node.getPrevSibling();r!==null?n.focus(c(r,o.node.panel)):n.focus(c(o.node.getParent(),o.node.panel))}}),n.keybindings.registerBinding({command:"prev",key:"arrowup"}),n.commands.registerCommand({id:"next",action:o=>{if(!o.node)return;let r=o.node.getNextSibling();r!==null?n.focus(c(r,o.node.panel)):n.focus(c(o.node.getParent().getNextSibling(),o.node.panel))}}),n.keybindings.registerBinding({command:"next",key:"arrowdown"}),n.commands.registerCommand({id:"pick-command",action:o=>{if(!o.node)return;let s=n.getInput(o.node).getBoundingClientRect(),a=i.body.scrollLeft+s.x+200,l=i.body.scrollTop+s.y;n.showPalette(a,l,n.newContext({node:o.node}))}}),n.keybindings.registerBinding({command:"pick-command",key:"meta+k"}),n.commands.registerCommand({id:"new-panel",title:"Open in New Panel",action:o=>{!o.node||(n.openNewPanel(o.node),m.redraw())}}),n.commands.registerCommand({id:"close-panel",title:"Close Panel",action:(o,r)=>{n.closePanel(r||o.node.panel),m.redraw()}}),n.commands.registerCommand({id:"zoom",title:"Zoom",action:o=>{o.node.panel.history.push(o.node),m.redraw()}}),n.keybindings.registerBinding({command:"zoom",key:"meta+z"}),n.menus.registerMenu("node",[{command:"zoom"},{command:"new-panel"},{command:"indent"},{command:"outdent"},{command:"delete"}]),i.addEventListener("keydown",o=>{let r=n.keybindings.evaluateEvent(o);r&&n.context.node&&(n.commands.executeCommand(r.command,n.context),o.stopPropagation(),o.preventDefault())}),i.addEventListener("click",o=>{n.hideMenu()}),m.mount(e,{view:()=>m(O,{workspace:n})})}export{V as LocalStorageStore,Se as setup};
