var a={view({attrs:n,state:e,children:t}){let r=n.data,o=r.Attrs.expanded!==void 0?JSON.parse(r.Attrs.expanded):!1,y=i=>{e.hover=!0,i.stopPropagation()},N=i=>{e.hover=!1,i.stopPropagation()},h=i=>{o?env.commands.executeCommand("collapse",r):env.commands.executeCommand("expand",r),i.stopPropagation()},b=i=>{env.workspace.currentNode=r,e.editing=!0,e.buffer=r.Name},k=i=>{e.editing=!1,r.Name=e.buffer,e.buffer=void 0,env.workspace.currentNode=void 0},R=i=>{e.buffer=i.target.value};return m("div",{class:"",style:{paddingLeft:"1rem"},onmouseover:y,onmouseout:N},m("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",marginTop:"0.125rem",marginBottom:"0.125rem"}},m("svg",{xmlns:"http://www.w3.org/2000/svg",style:{flexShrink:"0",width:"1rem",height:"1rem",position:"absolute",marginLeft:"-1rem",userSelect:"none",display:e.hover?"block":"none"},onclick:h,fill:"gray",viewBox:"0 0 16 16"},m("circle",{cx:"8",cy:"7",r:"7",fill:"lightgray"}),!o&&m("path",{style:{transform:"scale(0.6) translate(5px, 3px)"},d:"m12.14 8.753-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z"}),o&&m("path",{style:{transform:"scale(0.6) translate(5px, 4px)"},d:"M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"})),m("svg",{style:{flexShrink:"0",width:"1rem",height:"1rem",marginRight:"0.5rem",paddingLeft:"1px"},xmlns:"http://www.w3.org/2000/svg",fill:"gray",viewBox:"0 0 16 16"},n.data.Linked.Children.length>0?m("circle",{cx:"8",cy:"7",r:"7",fill:"lightgray"}):null,m("circle",{cx:"8",cy:"7",r:"3"})),m("div",{style:{flexGrow:"1",display:"flex"}},m("input",{type:"text",value:e.editing?e.buffer:n.data.Name,onfocus:b,onblur:k,oninput:R,style:{border:"0px",flexGrow:"1",outline:"0px"}}))),m("div",{style:{display:o?"flex":"none",flexDirection:"row",paddingBottom:"0.25rem"}},m("div",{style:{width:"1rem",marginRight:"0.25rem",display:"flex"},onclick:h},m("div",{style:{borderLeft:"1px solid gray",height:"100%",marginLeft:"0.5rem"}})),m("div",{style:{flexGrow:"1"}},n.data.getChildren().map(i=>m(a,{data:i})))))}};var l=class{loadAll(){let e=localStorage.getItem("treehouse-nodes");return e==="undefined"&&(e=void 0),JSON.parse(e||"[]")}saveAll(e){localStorage.setItem("treehouse-nodes",JSON.stringify(e))}save(e){}};var c=class{constructor(){this.bindings={}}registerBinding(e){this.bindings[e.command]=e}evaluateEvent(e){for(let t of Object.values(this.bindings)){let[r,o]=t.key.split("+");if(e[`${r}Key`]&&o===e.key.toLowerCase())return t}return null}};var u=class{constructor(){this.commands={}}registerCommand(e){this.commands[e.id]=e}executeCommand(e,...t){return this.commands[e].action(...t)}};var s=class{constructor(e,t){this.module=e,this.ID=t}changed(){this.module.notify(this.module.nodes[this.ID])}get Name(){return this.module.nodes[this.ID].Name}set Name(e){this.module.nodes[this.ID].Name=e,this.changed()}get Value(){return this.module.nodes[this.ID].Value}get Parent(){return this.module.nodes[this.ID].Parent}get Linked(){return this.module.nodes[this.ID].Linked}get Attrs(){return this.module.nodes[this.ID].Attrs}getParent(){if(!!this.Parent)return new s(this.module,this.Parent)}getChildren(){return this.Linked.Children?this.Linked.Children.map(e=>new s(this.module,e)):[]}},g=class{constructor(){this.nodes={},this.observers=[]}import(e){for(let t of e)this.nodes[t.ID]=t}export(){let e=[];for(let t of Object.values(this.nodes))e.push(t);return e}roots(){return Object.values(this.nodes).filter(e=>e.Parent===void 0).map(e=>new s(this,e.ID))}notify(e){this.observers.forEach(t=>t(e))}},C=()=>{let n=Date.now().toString(36),e=Math.random().toString(36).substring(2);return n+e};function S(n){return{ID:C(),Name:n,Linked:{Children:[]},Attrs:{}}}function A(n){let e=[];for(let t=0;t<n;t++)e.push(S(I(d(2,6))));return e}function v(n){let e={},t=A(n);t.forEach(r=>{e[r.ID]=r,d(0,4)>0&&(r.Parent=t[d(0,n-1)].ID)});for(let[r,o]of Object.entries(e))o.Parent===o.ID&&(o.Parent=void 0),o.Parent&&e[o.Parent].Linked.Children.push(o.ID);return e}var w=["Got","ability","shop","recall","fruit","easy","dirty","giant","shaking","ground","weather","lesson","almost","square","forward","bend","cold","broken","distant","adjective"];function D(n=!1){let e=w[d(0,w.length-1)];return n?e.charAt(0).toUpperCase()+e.slice(1):e}function I(n=10){return[...Array(n)].map((e,t)=>D(t===0)).join(" ").trim()}function d(n,e){return Math.round(Math.random()*(e-n)+n)}var f=class{constructor(){this.menus={}}registerMenu(e){this.menus[e.id]=e}};var p=class{constructor(e){this.workspace=new x(e),this.commands=new u,this.keybindings=new c,this.menus=new f}},x=class{constructor(e){this.backend=e,this.manifold=new g;let t=this.backend.loadAll();if(t.length===0)for(let r of Object.values(v(1e3)))t.push(r);this.manifold.import(t),this.manifold.observers.push(r=>{this.backend.saveAll(Object.values(this.manifold.nodes))})}};window.env=new p(new l);env.commands.registerCommand({id:"expand",action:n=>{n.Attrs.expanded=JSON.stringify(!0),n.changed(),m.redraw()}});env.keybindings.registerBinding({command:"expand",key:"meta+arrowdown"});env.commands.registerCommand({id:"collapse",action:n=>{n.Attrs.expanded=JSON.stringify(!1),n.changed(),m.redraw()}});env.keybindings.registerBinding({command:"collapse",key:"meta+arrowup"});document.addEventListener("keydown",n=>{let e=env.keybindings.evaluateEvent(n);e&&env.workspace.currentNode&&(env.commands.executeCommand(e.command,env.workspace.currentNode),n.stopPropagation(),n.preventDefault())});var P={view(n){return m("main",null,env.workspace.manifold.roots().map(e=>m(a,{data:e})))}};export{P as App};
